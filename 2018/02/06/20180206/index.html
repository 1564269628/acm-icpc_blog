<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <!--rewrit http to https-->
  <script type="text/javascript">
      var targetProtocol = "https:";
      if (window.location.protocol != targetProtocol && window.location.host != "localhost:4000")
          window.location.href = targetProtocol + window.location.href.substring(window.location.protocol.length);
  </script>
  <!--20190528-->

  <!--add new Bing in 20190708-->
  <meta name="msvalidate.01" content="A5D49B867EF1BB3C062DA0149A0A2E1E">

  <!--add new google in 20190502-->
  <meta name="google-site-verification" content="EMoSEE-nLoAdIHWBDmdYpa0t4XBCF8aLYOM3ayoI0pI">	
  <meta charset="utf-8">
  
  <title>《csapp》实践：信息的表示和处理 | 算法小站</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="计算机系统结构">
  
  
  
  
  <meta name="description" content="阅读深入理解计算机系统，书中的很多实践的练习值得尝试。">
<meta name="keywords" content="计算机系统结构">
<meta property="og:type" content="article">
<meta property="og:title" content="《csapp》实践：信息的表示和处理">
<meta property="og:url" content="https://www.fogsail.net/2018/02/06/20180206/index.html">
<meta property="og:site_name" content="算法小站">
<meta property="og:description" content="阅读深入理解计算机系统，书中的很多实践的练习值得尝试。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/02.png">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/01.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/03.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/04.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/05.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/06.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/07.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/08.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/09.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/10.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/11.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/12.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/13.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/14.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/15.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/16.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/17.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/18.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/19.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/20.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/21.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/22.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/23.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/24.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/25.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/26.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/27.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/28.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/29.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/30.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/31.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/32.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/33.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/34.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/35.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/36.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/37.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/38.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/39.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/40.jpg">
<meta property="og:image" content="https://www.fogsail.net/2018/02/06/20180206/41.jpg">
<meta property="og:updated_time" content="2019-03-06T10:04:55.726Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="《csapp》实践：信息的表示和处理">
<meta name="twitter:description" content="阅读深入理解计算机系统，书中的很多实践的练习值得尝试。">
<meta name="twitter:image" content="https://www.fogsail.net/2018/02/06/20180206/02.png">
  
    <link rel="alternate" href="/atom.xml" title="算法小站" type="application/atom+xml">
  

  

  <link rel="icon" href="/css/images/mylogo.jpg">
  <link rel="apple-touch-icon" href="/css/images/mylogo.jpg">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <!-- <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style> -->
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>
  <script src="/js/bootstrap.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css">

  
    <link rel="stylesheet" href="/css/dialog.css">
  

  

  
    <link rel="stylesheet" href="/css/header-post.css">
  

  
  
  
    <link rel="stylesheet" href="/css/vdonate.css">
  
  <script src="//msite.baidu.com/sdk/c.js?appid=1593711792635024"></script>

  <!--baidu-ldjson-->
  <!--以下是新添加的内容-->
  <script type="application/ld+json">
    {
        "@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
        "@id": "http://www.fogsail.net/2018/02/06/20180206/",
        "appid": "1593711792635024",
        "title": "《csapp》实践：信息的表示和处理",
        "images": [
        "http://www.fogsail.net/2018/02/06/20180206/01.png",
        "http://www.fogsail.net/2018/02/06/20180206/01.jpg"
        ], //请在此处添加希望在搜索结果中展示图片的url，可以添加1个或3个url
        "pubDate": "2018-02-06T11:00:00" // 需按照yyyy-mm-ddThh:mm:ss格式编写时间，字母T不能省去
    }
</script>

</head>
</html>


  <body data-spy="scroll" data-target="#toc" data-offset="50">


  
  <div id="container">
    <div id="wrap">
      
        <header>

    <div id="allheader" class="navbar navbar-default navbar-static-top" role="navigation">
        <div class="navbar-inner">
          
          <div class="container"> 
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>

            
              <a class="brand" style="
                 margin-top: 0px;" href="#" data-toggle="modal" data-target="#myModal">
                  <img width="124px" height="124px" alt="Hike News" src="/css/images/mylogo.jpg">
              </a>
            
            
            <div class="navbar-collapse collapse">
              <ul class="hnav navbar-nav">
                
                  <li> <a class="main-nav-link" href="/">首页</a> </li>
                
                  <li> <a class="main-nav-link" href="/archives">所有文章</a> </li>
                
                  <li> <a class="main-nav-link" href="/categories">分类</a> </li>
                
                  <li> <a class="main-nav-link" href="/tags">标签</a> </li>
                
                  <li> <a class="main-nav-link" href="/about">关于我</a> </li>
                
                  <li><div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder>
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="请输入关键词...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(无标题)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div></li>
            </ul></div>
          </div>
                
      </div>
    </div>

</header>



      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-20180206" style="width: 75%; float:left;" class="article article-type-post" itemscope itemprop="blogPost">
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      《csapp》实践：信息的表示和处理
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/02/06/20180206/" class="article-date">
	  <time datetime="2018-02-06T03:00:00.000Z" itemprop="datePublished">2018-02-06</time>
	</a>

      
    <a class="article-category-link" href="/categories/计算机系统结构/">计算机系统结构</a>

      
	<a class="article-views">
	<span id="busuanzi_container_page_pv">
		阅读量<span id="busuanzi_value_page_pv"></span>
	</span>
	</a>

      

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>阅读深入理解计算机系统，书中的很多实践的练习值得尝试。<br><a id="more"></a></p>
<h2 id="show-bytes"><a href="#show-bytes" class="headerlink" title="show bytes"></a>show bytes</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">void show_bytes(byte_pointer start, size_t len)</span><br><span class="line">//这里的len表示从start开始</span><br><span class="line">//包括start，例如ab ed 这样，每2个数字为一个单位</span><br><span class="line">//总共有几个单位？</span><br></pre></td></tr></table></figure>
<p>show_bytes的使用，具体能够打印类型为short、long和double的c语言对象的字节表示：<br>具体实现如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line">/* <span class="variable">$begin</span> show-bytes */</span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line">/* <span class="variable">$end</span> show-bytes */</span><br><span class="line"><span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;string.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;iostream&gt;</span></span><br><span class="line"></span><br><span class="line">/* <span class="variable">$begin</span> show-bytes */</span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">typedef unsigned char *byte_pointer;</span><br><span class="line">//unsigned char * 显示一位</span><br><span class="line"></span><br><span class="line">void show_bytes(byte_pointer start, size_t len) &#123;</span><br><span class="line">    size_t i;</span><br><span class="line">    //int k=0;</span><br><span class="line">    <span class="keyword">for</span> (i = 0; i &lt; len; i++)</span><br><span class="line">	     <span class="built_in">printf</span>(<span class="string">" %.2x"</span>, start[i]);    //line:data:show_bytes_printf</span><br><span class="line">       //buf[k++]=start[i];</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void show_int(int x) &#123;</span><br><span class="line">    show_bytes((byte_pointer) &amp;x, sizeof(int)); //line:data:show_bytes_amp1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void show_float(<span class="built_in">float</span> x) &#123;</span><br><span class="line">    show_bytes((byte_pointer) &amp;x, sizeof(<span class="built_in">float</span>)); //line:data:show_bytes_amp2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void show_pointer(void *x) &#123;</span><br><span class="line">    show_bytes((byte_pointer) &amp;x, sizeof(void *)); //line:data:show_bytes_amp3</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void show_short(short x)&#123;</span><br><span class="line">    show_bytes((byte_pointer) &amp;x, sizeof(short));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void show_long(long x)&#123;</span><br><span class="line">    show_bytes((byte_pointer) &amp;x, sizeof(long));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void show_double(double x)&#123;</span><br><span class="line">    show_bytes((byte_pointer) &amp;x, sizeof(double));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* <span class="variable">$end</span> show-bytes */</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/* <span class="variable">$begin</span> <span class="built_in">test</span>-show-bytes */</span><br><span class="line">void test_show_bytes(int val) &#123;</span><br><span class="line">    int ival = val;</span><br><span class="line">    <span class="built_in">float</span> fval = (<span class="built_in">float</span>) ival;</span><br><span class="line">    int *pval = &amp;ival;</span><br><span class="line">    show_int(ival);</span><br><span class="line">    show_float(fval);</span><br><span class="line">    show_pointer(pval);</span><br><span class="line">&#125;</span><br><span class="line">/* <span class="variable">$end</span> <span class="built_in">test</span>-show-bytes */</span><br><span class="line"></span><br><span class="line">void <span class="function"><span class="title">simple_show_a</span></span>() &#123;</span><br><span class="line">/* <span class="variable">$begin</span> simple-show<span class="_">-a</span> */</span><br><span class="line">int val = 0x87654321;</span><br><span class="line">byte_pointer valp = (byte_pointer) &amp;val;</span><br><span class="line">show_bytes(valp, 1); /* A. */</span><br><span class="line">show_bytes(valp, 2); /* B. */</span><br><span class="line">show_bytes(valp, 3); /* C. */</span><br><span class="line">show_bytes(valp, 4);</span><br><span class="line">/* <span class="variable">$end</span> simple-show<span class="_">-a</span> */</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void <span class="function"><span class="title">simple_show_b</span></span>() &#123;</span><br><span class="line">/* <span class="variable">$begin</span> simple-show-b */</span><br><span class="line">int val = 0x12345678;</span><br><span class="line">byte_pointer valp = (byte_pointer) &amp;val;</span><br><span class="line">show_bytes(valp, 1); /* A. */</span><br><span class="line">show_bytes(valp, 2); /* B. */</span><br><span class="line">show_bytes(valp, 3); /* C. */</span><br><span class="line">/* <span class="variable">$end</span> simple-show-b */</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void <span class="function"><span class="title">float_eg</span></span>() &#123;</span><br><span class="line">  int x = 3490593;</span><br><span class="line">  <span class="built_in">float</span> f = (<span class="built_in">float</span>) x;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"For x = %d\n"</span>, x);</span><br><span class="line">  show_int(x);</span><br><span class="line">  show_float(f);</span><br><span class="line"></span><br><span class="line">  x = 3510593;</span><br><span class="line">  f = (<span class="built_in">float</span>) x;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"For x = %d\n"</span>, x);</span><br><span class="line">  show_int(x);</span><br><span class="line">  show_float(f);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void <span class="function"><span class="title">string_ueg</span></span>() &#123;</span><br><span class="line">/* <span class="variable">$begin</span> show-ustring */</span><br><span class="line">const char *s = <span class="string">"ABCDEF"</span>;</span><br><span class="line">show_bytes((byte_pointer) s, strlen(s));</span><br><span class="line">/* <span class="variable">$end</span> show-ustring */</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void <span class="function"><span class="title">string_leg</span></span>() &#123;</span><br><span class="line">/* <span class="variable">$begin</span> show-lstring */</span><br><span class="line">const char *s = <span class="string">"abcdef"</span>;</span><br><span class="line">show_bytes((byte_pointer) s, strlen(s));</span><br><span class="line">/* <span class="variable">$end</span> show-lstring */</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void show_twocomp()</span><br><span class="line">&#123;</span><br><span class="line">/* <span class="variable">$begin</span> show-twocomp */</span><br><span class="line">    short x = 12345;</span><br><span class="line">    short mx = -x;</span><br><span class="line"></span><br><span class="line">    show_bytes((byte_pointer) &amp;x, sizeof(short));</span><br><span class="line">    show_bytes((byte_pointer) &amp;mx, sizeof(short));</span><br><span class="line">/* <span class="variable">$end</span> show-twocomp */</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//check is_litter_endian</span><br><span class="line">bool is_litter_endian()</span><br><span class="line">&#123;</span><br><span class="line">    int a = 0x123456;</span><br><span class="line">    <span class="keyword">if</span>( *((char*)&amp;a) == 0x56)</span><br><span class="line">        <span class="built_in">return</span> 1;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    int val = 12345;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (argc &gt; 1) &#123;</span><br><span class="line">	       <span class="keyword">if</span> (argc &gt; 1) &#123;</span><br><span class="line">	          val = strtol(argv[1], NULL, 0);</span><br><span class="line">	       &#125;</span><br><span class="line">	       <span class="built_in">printf</span>(<span class="string">"calling test_show_bytes\n"</span>);</span><br><span class="line">	       test_show_bytes(val);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">	           <span class="built_in">printf</span>(<span class="string">"calling show_twocomp\n"</span>);</span><br><span class="line">	           show_twocomp();</span><br><span class="line">	           <span class="built_in">printf</span>(<span class="string">"Calling simple_show_a\n"</span>);</span><br><span class="line">	           simple_show_a();</span><br><span class="line">	           <span class="built_in">printf</span>(<span class="string">"Calling simple_show_b\n"</span>);</span><br><span class="line">	           simple_show_b();</span><br><span class="line">	           <span class="built_in">printf</span>(<span class="string">"Calling float_eg\n"</span>);</span><br><span class="line">	           float_eg();</span><br><span class="line">	           <span class="built_in">printf</span>(<span class="string">"Calling string_ueg\n"</span>);</span><br><span class="line">	           string_ueg();</span><br><span class="line">	           <span class="built_in">printf</span>(<span class="string">"Calling string_leg\n"</span>);</span><br><span class="line">	           string_leg();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">             //exercise 2.59</span><br><span class="line">             <span class="keyword">if</span>(is_litter_endian())</span><br><span class="line">                cout&lt;&lt;<span class="string">"litter endian"</span>&lt;&lt;endl;</span><br><span class="line">             <span class="keyword">else</span></span><br><span class="line">                cout&lt;&lt;<span class="string">"big endian"</span>&lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果见图：</p>
<p><img src="/2018/02/06/20180206/02.png" alt="02"></p>
<p>可以发现，我的电脑是小端法机器，浮点数的编码方法，和二进制的编码方法不太一样，浮点数的编码方法，我在<br><a href="http://localhost:4000/2018/02/04/%E5%84%BF%E6%97%B6%E6%B8%B8%E6%88%8F%EF%BC%9A%E6%95%B0%E7%BB%84%E5%92%8C%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A8%A1%E6%8B%9F/" target="_blank" rel="noopener">浮点数编码方法</a><br>最后一个例子有详细说明。</p>
<p>其中值得一提的是，取最低有效字节的方法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x &amp; 0xFF  //取出x的最低有效字节</span><br><span class="line">y &amp; ~0xFF  //取出y的最低有效字节</span><br><span class="line">((x &amp; 0xff) | (y &amp; ~0xff))  //能够实现x的最低有效字节和</span><br><span class="line">//y除了最低有效字节外的其他字节合并</span><br></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"></span><br><span class="line">//注意：不要打0x作为输入</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int x,y;</span><br><span class="line">    int res;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Please int x(H) and y(H): "</span>);</span><br><span class="line">    scanf(<span class="string">"%x%x"</span>,&amp;x,&amp;y);</span><br><span class="line">    res = ((x &amp; 0x000000ff) | (y &amp; 0xffffff00));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"The result is %.8x(H)\n"</span>,res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>类似的方法，常常用于处理某一个字节替换问题：</strong></p>
<p>结论见图：</p>
<p><img src="/2018/02/06/20180206/01.jpg" alt="01"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;iostream&gt;</span></span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">unsigned replace_byte(unsigned x, unsigned char b, int i)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> (x &amp; ~(0xff&lt;&lt;(i&lt;&lt;3))) | (b&lt;&lt;(i&lt;&lt;3));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"0x%x\n"</span>,replace_byte(0x12345678,0xab,2));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"0x%x\n"</span>,replace_byte(0x12345678,0xab,0));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">`</span><br></pre></td></tr></table></figure>
<h2 id="位级整数编码原则"><a href="#位级整数编码原则" class="headerlink" title="位级整数编码原则"></a>位级整数编码原则</h2><h3 id="算术右移和逻辑右移的关系"><a href="#算术右移和逻辑右移的关系" class="headerlink" title="算术右移和逻辑右移的关系"></a>算术右移和逻辑右移的关系</h3><p>算术右移和逻辑右移是不一样的<br>算术右移需要考虑符号位，右移一位，若符号位为1，在左边补1<br>逻辑右移，补0就可以</p>
<p>这里以-1为例，-1算术右移一位，所产生的二进制码代表的数值不变；而逻辑右移则会使最高位为0，变成（1&lt;&lt;63）-1，最大值。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;iostream&gt;</span></span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">int judge_if_all_1(int x)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> !(~x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int judge_if_all_0(int x)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> !x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int judge_low_is_0(int x)</span><br><span class="line">&#123;</span><br><span class="line">    //最低有效字节：x &amp; 0xff</span><br><span class="line">    <span class="built_in">return</span> !(x &amp; 0xff);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int judge_low_is_1(int x)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> (x &amp; 0xff);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int judge_high_is_0(int x)</span><br><span class="line">&#123;</span><br><span class="line">    //除最高字节以外的位数</span><br><span class="line">    //howmanybit=(sizeof(int)-1)&lt;&lt;3</span><br><span class="line">    // a&lt;&lt;3表示a*8，因为一位有8个比特</span><br><span class="line"></span><br><span class="line">    //右移howmanybit位</span><br><span class="line">    <span class="built_in">return</span> !( (x&gt;&gt;((sizeof(x)-1)&lt;&lt;3)) );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int a;</span><br><span class="line">    scanf(<span class="string">"%x"</span>,&amp;a);</span><br><span class="line"></span><br><span class="line">    cout&lt;&lt;judge_low_is_0(a)&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;judge_low_is_1(a)&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;judge_high_is_0(a)&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;judge_if_all_0(a)&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;judge_if_all_1(a)&lt;&lt;endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;iostream&gt;</span></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">//int_shifts_are_arithmetic()</span><br><span class="line">//对int类型数使用算术右移返回1，否则返回0；</span><br><span class="line">//显然，只需考虑负数即可（非负数算术右移与逻辑右移相同）。</span><br><span class="line">//显这里以-这里以-这里以-这里以-1为例，</span><br><span class="line">//-1算术右移一位，所产生的二进制码代表的数值不变；</span><br><span class="line">//-而逻辑右移则会使最高位为0，变成（1&lt;&lt;31）-1，最大值。</span><br><span class="line"></span><br><span class="line">int int_shifts_are_arithmetic()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%x %x\n"</span>, ((-1)&gt;&gt;1),-1);</span><br><span class="line">    <span class="built_in">return</span> ((-1)&gt;&gt;1)==-1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    cout&lt;&lt;int_shifts_are_arithmetic()&lt;&lt;endl;</span><br><span class="line">    <span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>算术右移有一个特点，移几位，补几个最高位<br>举一个例子<br>$[x_{w-1},x_{w-1}…x_{w-1},x_{w-2}…x_{k}]$</p>
<h3 id="算术右移和逻辑右移相互表示"><a href="#算术右移和逻辑右移相互表示" class="headerlink" title="算术右移和逻辑右移相互表示"></a>算术右移和逻辑右移相互表示</h3><p>这里先提一点：算术右移和逻辑右移，其中涉及到有符号数和无符号数的相互转换，这个问题比较重要，公式如下：</p>
<script type="math/tex; mode=display">T2U_w(x)=
\begin{cases}
x+2^w& \text{x<0}\\
x& \text{x>=0}
\end{cases}</script><p>一个无符号数，转换成对应的有符号数，依据是：补码原则</p>
<script type="math/tex; mode=display">U2T_w(x)=
\begin{cases}
u& \text{u<TMaxw}\\
u-2^w& \text{u>TMaxw}
\end{cases}</script><p>其中$TMax_w$表示符号类型如$int$最大的位数</p>
<p><strong>基于以上公式，我们发现从$int$类型向$unsigned$类型转换的时候，只有x为负数，逻辑右移和算术右移才能够体现出区别，我们这里仅研究$x&lt;0$的情况</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sra()表示用逻辑右移完成算术右移</span><br><span class="line">srl()表示用算术右移完成逻辑右移</span><br></pre></td></tr></table></figure>
<p>原理表示如下(仅仅研究$x&lt;0$情况)：<br><img src="/2018/02/06/20180206/03.jpg" alt="03"></p>
<p><img src="/2018/02/06/20180206/04.jpg" alt="04"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">int sra(int x,int k)</span><br><span class="line">&#123;</span><br><span class="line">    //Perform <span class="built_in">shift</span> logically</span><br><span class="line">    int xsrl = (unsigned)x &gt;&gt; k; //转换成为无符号数</span><br><span class="line">    int w = (sizeof(int))&lt;&lt;3;</span><br><span class="line">    returnx xsrl |= (-1 &lt;&lt; (w-k));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">unsigned srl(unsigned x, int k)</span><br><span class="line">&#123;</span><br><span class="line">    //Perform <span class="built_in">shift</span> arithmetically</span><br><span class="line">    unsigned xsra = (int) x &gt;&gt; k;</span><br><span class="line">    int w = (sizeof(int)) &lt;&lt; 3;</span><br><span class="line">    <span class="built_in">return</span> xsra &amp;= ~(-1 &lt;&lt; (w-k));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="判断奇数位是否为1"><a href="#判断奇数位是否为1" class="headerlink" title="判断奇数位是否为1"></a>判断奇数位是否为1</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;iostream&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bool any_odd_one(unsigned x)</span><br><span class="line">&#123;</span><br><span class="line">    //将所有的奇数位全部置为0，偶数位不变</span><br><span class="line">    //考虑&amp;...01010101</span><br><span class="line">    //&amp;0x55555555(32bits)</span><br><span class="line">    //若奇数位有1，则提取奇数位，结果不为0</span><br><span class="line">    <span class="built_in">return</span> 0!=(x&amp;0x55555555);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,any_odd_one(0x5) );</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,any_odd_one(0x25) );</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,any_odd_one(0x7) );</span><br><span class="line">    <span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="二分法位运算：有多少个位包含1"><a href="#二分法位运算：有多少个位包含1" class="headerlink" title="二分法位运算：有多少个位包含1"></a>二分法位运算：有多少个位包含1</h3><p><strong>注意：^异或运算，相当于无进位的加法，可以消除位中的1</strong></p>
<p><img src="/2018/02/06/20180206/05.jpg" alt="05"></p>
<p>有两种方法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;iostream&gt;</span></span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">//不用位运算的方法</span><br><span class="line">int even_ones_without_bit(unsigned x)</span><br><span class="line">&#123;</span><br><span class="line">    int result = 0;</span><br><span class="line">    <span class="keyword">for</span>(int i=0;i&lt;(sizeof(int)&lt;&lt;3);i++)</span><br><span class="line">    &#123;</span><br><span class="line">        int y = x&gt;&gt;i;</span><br><span class="line">        y=y&amp;1;</span><br><span class="line">        <span class="keyword">if</span>(y)</span><br><span class="line">          result++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(result%2)</span><br><span class="line">        <span class="built_in">return</span> 1;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int odd_ones(unsigned x)</span><br><span class="line">&#123;</span><br><span class="line">    //用异或运算消除偶数</span><br><span class="line">    x ^= (x&gt;&gt;16);</span><br><span class="line">    x ^= (x&gt;&gt;8);</span><br><span class="line">    x ^= (x&gt;&gt;4);</span><br><span class="line">    x ^= (x&gt;&gt;2);</span><br><span class="line">    x ^= (x&gt;&gt;1);</span><br><span class="line">    <span class="built_in">return</span> (x&amp;1);</span><br><span class="line">&#125;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int x;</span><br><span class="line">    scanf(<span class="string">"%x"</span>,&amp;x);</span><br><span class="line">    int res=odd_ones(x);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="二分法运算：只保留最高位的1"><a href="#二分法运算：只保留最高位的1" class="headerlink" title="二分法运算：只保留最高位的1"></a>二分法运算：只保留最高位的1</h3><p><img src="/2018/02/06/20180206/06.jpg" alt="06"></p>
<p>函数功能如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0xFF00--&gt;0x8000 0x6600--&gt;0x4000</span><br></pre></td></tr></table></figure></p>
<p>实现方法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"></span><br><span class="line">int leftmost_one(unsigned x)</span><br><span class="line">&#123;</span><br><span class="line">    x |= (x&gt;&gt;1);</span><br><span class="line">    x |= (x&gt;&gt;2);</span><br><span class="line">    x |= (x&gt;&gt;4);</span><br><span class="line">    x |= (x&gt;&gt;8);</span><br><span class="line">    x |= (x&gt;&gt;16);</span><br><span class="line"></span><br><span class="line">    x &amp;= ~(x&gt;&gt;1);</span><br><span class="line">    <span class="built_in">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int x;</span><br><span class="line">    scanf(<span class="string">"%x"</span>,&amp;x);</span><br><span class="line">    int res=leftmost_one(x);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%x\n"</span>,res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="移位运算需要注意的"><a href="#移位运算需要注意的" class="headerlink" title="移位运算需要注意的"></a>移位运算需要注意的</h3><p>可以知道：移位运算，移位的量，区间是$(0,w-1)$<br>通过移位运算，使得在32位的机器上可以运行</p>
<p>这里说一下移位运算的溢出：<br>注意第一位是符号位<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0000 -- 0</span><br><span class="line">0001 -- 1</span><br><span class="line">0010 -- 2</span><br><span class="line">...</span><br><span class="line">0111 -- 7</span><br><span class="line">1000 -- -8</span><br></pre></td></tr></table></figure></p>
<p>以32位机器举例，int的最大值位$2^{32-1}=2147483648$<br>int型，若为正数，可以表示的最大的数为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0111 1111 1111 1111 1111 1111 1111 1111</span><br><span class="line">//最高位是符号位，为0,值为2147483647</span><br><span class="line">//加上1之后</span><br><span class="line">1000 0000 0000 0000 0000 0000 0000 0000</span><br><span class="line">//值为负数，-2147483648</span><br></pre></td></tr></table></figure></p>
<p>判断一个机器是否为32位，只要用上述方法可以判断。<br>具体实现如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"></span><br><span class="line">bool int_size_is_32()</span><br><span class="line">&#123;</span><br><span class="line">    int set_msb = ~(1&lt;&lt;31);</span><br><span class="line">    <span class="built_in">return</span> (set_msb+1&lt;0);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    bool res = int_size_is_32();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="位级运算完成置位"><a href="#位级运算完成置位" class="headerlink" title="位级运算完成置位"></a>位级运算完成置位</h3><h4 id="lower-one-mask"><a href="#lower-one-mask" class="headerlink" title="lower_one_mask"></a>lower_one_mask</h4><p>使用位级运算完成置位的过程，通常需要将二进制转换成如下形式：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">00000 111111</span><br><span class="line">//即前几个数都为0，后几个数都为1的形式</span><br><span class="line"></span><br><span class="line">//lower_one_mask函数的实现</span><br><span class="line">//0xFFFFFFFF&gt;&gt;(32-n)</span><br><span class="line">//00...011...1形式，最后就有n位为1</span><br></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"></span><br><span class="line">int lower_one_mask(int n)</span><br><span class="line">&#123;</span><br><span class="line">    unsigned mark = 0xffffffff;</span><br><span class="line">    mark = mark &gt;&gt; (32-n);</span><br><span class="line">    <span class="built_in">return</span> mark;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int n;</span><br><span class="line">    scanf(<span class="string">"%d"</span>,&amp;n);</span><br><span class="line">    int res = lower_one_mask(n);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%x"</span>,res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="旋转：rotate-left"><a href="#旋转：rotate-left" class="headerlink" title="旋转：rotate_left"></a>旋转：rotate_left</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//取最高m位和最低n位的方法：</span><br><span class="line">x&gt;&gt;(32-m)</span><br><span class="line">x&lt;&lt;(32-n)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"></span><br><span class="line">unsigned rotate_left(unsigned x, int n)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(n==0)</span><br><span class="line">        <span class="built_in">return</span> x;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        unsigned low = x&lt;&lt;n;</span><br><span class="line">        unsigned high = x&gt;&gt;(32-n);</span><br><span class="line">        <span class="built_in">return</span> low | high;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int x,n;</span><br><span class="line">    scanf(<span class="string">"%x%d"</span>,&amp;x,&amp;n);</span><br><span class="line">    int res=rotate_left(x,n);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%x\n"</span>,res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="补码运算的原理"><a href="#补码运算的原理" class="headerlink" title="补码运算的原理"></a>补码运算的原理</h3><p>1、补码中取反，反码的求法。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">反码，以下讨论不包括符号位</span><br><span class="line">010110的反码</span><br><span class="line">111111-010110 = 101001</span><br><span class="line">这里不讨论符号位</span><br></pre></td></tr></table></figure>
<p>2、补码原理：</p>
<p>假设计算机字长为n，源码、反码和补码的关系如下：<br><img src="/2018/02/06/20180206/07.jpg" alt="07"></p>
<p><strong>原码：</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[+1]_源 = 0000 0001</span><br><span class="line">[-1]_源 = 1000 0001</span><br><span class="line">其中第一位为符号位</span><br><span class="line">取值范围</span><br><span class="line">[1111 1111, 01111 1111]</span><br><span class="line">--&gt;[-127,127]</span><br></pre></td></tr></table></figure></p>
<p>从公式上看，当$x&gt;0$时，很显然x的源码就是x自身<br>$x&lt;0$时候，除去最高位外，剩下的位数的值等于$|x|=-x$，<br>再加上最高位的1，即加上$2^{n-1}$，最后的值为$2^{n-1}-x$</p>
<p><strong>反码：</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">正数反码不变</span><br><span class="line">负数反码，符号位不变，各位取反</span><br><span class="line">[+1]=[0000 0001]_源=[0000 0001]_反</span><br><span class="line">[-1]=[1000 0001]_源=[1111 1110]_反</span><br><span class="line"></span><br><span class="line">可以用[1000 0000]表示-128</span><br></pre></td></tr></table></figure></p>
<p>负数的反码，除了符号位，各位取反，其实是<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">仅看数值位(n-1)</span><br><span class="line">11...1 - xxxxx</span><br></pre></td></tr></table></figure></p>
<p>数值位取反即为$2^{(n-1)}-1-(-x)=2^{(n-1)}-1+x$<br>解释：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0xffffffff-(-x)</span><br></pre></td></tr></table></figure></p>
<p>最高位，即符号位为$2^{n-1}$，数值位全部为1，表示为$2^{n-1}-1$<br>数值位取反$2^{n-1}-1-(-x)$</p>
<p>最后我们再加上符号位$2^{n-1}$<br>所以答案为$2^{n-1}+(2^{n-1}-1+x)=2^n+x-1$</p>
<p><strong>补码：</strong><br>为什么是取反码加一？<br>假设我们有正数 0000 0000 0000 1111，我们如何表示其相反数呢？一般我们的思路是，找一个数，跟它相加的结果等于0，但是我们发现，要找出一个与它相加后结果等于0的数还是要略加思考一下的（因为要计算进位），所以，为何不找出一个与它相加后结果是1111 1111 1111 1111的数，然后该数+1即是我们所要的答案啦。</p>
<p>A+(相加等于全部是11111的数)+1 = 0<br>所以A的相反数等于：求出与A相加全部是11…1的数，然后加1<br>于是就推出：<br>补码等于反码+1</p>
<p><img src="/2018/02/06/20180206/08.jpg" alt="08"><br><strong>缩进后再暴露最高位的方法，来看看补码是否等于原来的数</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"></span><br><span class="line">//一个数能够用二进制补码表示</span><br><span class="line">//可以知道这个数为正数</span><br><span class="line">int fits_bits(int x, int n)</span><br><span class="line">&#123;</span><br><span class="line">    //对最高位进行缩进表示</span><br><span class="line">    int bias = (sizeof(int) &lt;&lt; 3)-n;</span><br><span class="line">    <span class="built_in">return</span> ((x&lt;&lt;bias)&gt;&gt;bias)==x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int x,n;</span><br><span class="line">    scanf(<span class="string">"%d%d"</span>,&amp;x,&amp;n);</span><br><span class="line">    int res = fits_bits(x,n);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="xbyte"><a href="#xbyte" class="headerlink" title="xbyte"></a>xbyte</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"></span><br><span class="line">typedef unsigned packed_t;</span><br><span class="line"></span><br><span class="line">int xbyte(packed_t word, int bytenum)</span><br><span class="line">&#123;</span><br><span class="line">    int move_to_high = (3-bytenum)&lt;&lt;3;</span><br><span class="line">    //将要处理的字节移动到首字节</span><br><span class="line">    unsigned mask = (0xff) &lt;&lt; 24;</span><br><span class="line">    //第一个字节设置掩码</span><br><span class="line"></span><br><span class="line">    int res = (word &lt;&lt; move_to_high) &amp; mask;</span><br><span class="line">    res = res &gt;&gt; 24;</span><br><span class="line">    <span class="built_in">return</span> res;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int hex,n;</span><br><span class="line">    scanf(<span class="string">"%x%d"</span>,&amp;hex,&amp;n);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%x\n"</span>,xbyte(hex,n));</span><br><span class="line">    <span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>特别注意的地方：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(maxbytes-sizeof(val)&gt;=0)</span><br><span class="line">&#123;</span><br><span class="line">    //</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">条件是恒正的，因为结果是无符号数，无符号数大于0是肯定的</span><br><span class="line">正确写法：</span><br><span class="line"><span class="keyword">if</span>(maxbytes&gt;=sizeof(val))</span><br></pre></td></tr></table></figure></p>
<h3 id="位运算实现饱和加法"><a href="#位运算实现饱和加法" class="headerlink" title="位运算实现饱和加法"></a>位运算实现饱和加法</h3><p>饱和加法，在正溢出的时候，返回$TMax$。</p>
<p>先来看正常情况下的加法<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">两个正数加法溢出</span><br><span class="line">011...1 + 1 = 100...0</span><br><span class="line">最后sum的符号位被置为1</span><br></pre></td></tr></table></figure></p>
<p>所以最后的$TMax$会是一个绝对值比较大的负数</p>
<p>这里我们要返回$TMax$<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;iostream&gt;</span></span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">int saturating_add(int x, int y)</span><br><span class="line">&#123;</span><br><span class="line">    int mask = INT_MIN;</span><br><span class="line">    //INT_MIN所有位均为1，构成了掩码</span><br><span class="line"></span><br><span class="line">    int sum = x+y;</span><br><span class="line">    int w = sizeof(int)&lt;&lt;3;</span><br><span class="line"></span><br><span class="line">    //负溢出的时候，获取最小值</span><br><span class="line">    //负溢出的情况，原来x,y的第一位为1</span><br><span class="line">    //即有(x &amp; mask) (y &amp; mask)</span><br><span class="line">    //注意&amp;&amp;运算，() &amp;&amp; ()，</span><br><span class="line">    //注意&amp;&amp;运算，连接两个非0数，</span><br><span class="line">    //结果也只为0或者1</span><br><span class="line">    //(x &amp; mask) &amp;&amp; (y &amp; mask) &amp;&amp; !(sum &amp; mask)</span><br><span class="line">    //在负溢出的时候为1，1&lt;&lt;(w-1)&gt;&gt;(w-1)</span><br><span class="line">    //会把所有的位置为1，因为有符号数要补上符号位</span><br><span class="line">    //最后 &amp; INT_MIN，保证INT_MIN正确输出</span><br><span class="line"></span><br><span class="line">    int tmin = ( ((x&amp;mask) &amp;&amp; (y&amp;mask) &amp;&amp; !(sum&amp;mask)) &lt;&lt;(w-1)&gt;&gt;(w-1) ) &amp; INT_MIN;</span><br><span class="line">    //这一步，关键是如果前半部分的值为1，说明溢出，溢出返回的是INT_MIN</span><br><span class="line">    //不用<span class="keyword">if</span>语句，我们要得到INT_MIN，需要INT_MIN &amp; 11...1</span><br><span class="line">    //前半部分的值为1，要让所有的位值都是1，需要&lt;&lt;(w-1)&gt;&gt;(w-1)</span><br><span class="line">    //算术右移，前面是带上符号位的</span><br><span class="line"></span><br><span class="line">    int tmax = ( ((~x&amp;mask) &amp;&amp; (~y&amp;mask) &amp;&amp; (sum&amp;mask)) &lt;&lt;(w-1)&gt;&gt;(w-1) ) &amp; INT_MAX;</span><br><span class="line">    <span class="built_in">return</span> (sum&amp; ~(!(tmin | tmax))) | tmin | tmax;</span><br><span class="line"></span><br><span class="line">    //这里重点说明一下没有溢出的情况：</span><br><span class="line">    //[tmin,tmax) 其中tmin=11...1 tmax=011...1</span><br><span class="line">    //tmin|tmax = 11...1，这样的目的是把符号位的1也参与进运算中</span><br><span class="line">    //--&gt; !(tmin | tmax)=00...0 --&gt; ~(!(tmin|tmax))=11...1</span><br><span class="line">    //sum &amp; res = sum，符号位也原封不动地包含下来</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void show_saturating_add(int x,int y)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"satuarating_add(0x%08x,0x%08x)=0x%08x--&gt;%d\n"</span>,x,y,saturating_add(x,y),saturating_add(x,y));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d+%d=%d\n"</span>,x,y,x+y);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int x,y;</span><br><span class="line">    scanf(<span class="string">"%x%x"</span>,&amp;x,&amp;y);</span><br><span class="line">    show_saturating_add(x,y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>同样，怎么判断减法是否溢出呢？<br>减法的溢出会导致一个非常大的正数，用这样的思路来分析。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;iostream&gt;</span></span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">//判断x-y溢出，返回1</span><br><span class="line">int tsub_ok(int x,int y)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> ( (y&gt;0 &amp;&amp; x-y&gt;x) || (y&lt;0 &amp;&amp; x-y&lt;x) );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void show_tsub_ovf(int x, int y)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d-%d=%d %s\n"</span>,x,y,x-y,tsub_ok(x,y)?<span class="string">"overflow"</span>:<span class="string">"not_overflow"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int x,y;</span><br><span class="line">    scanf(<span class="string">"%x%x"</span>,&amp;x,&amp;y);</span><br><span class="line">    show_tsub_ovf(x,y);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="理解定点数的乘法"><a href="#理解定点数的乘法" class="headerlink" title="理解定点数的乘法"></a>理解定点数的乘法</h3><p>对于位模式$x$，我们计算$B2U_w(x)-B2T_w(x)=x_{w-1}(2^{w-1}-(-2^{w-1}))=x_{w-1}2^w$<br>$B2U_w(T2B_w(x))=T2U_w(x)=x+x_{w-1}2^w$<br>$x’=x+x_{w-1}2^w$<br>$y’=y+y_{w-1}2^w$<br>$(x’\times y’)mod 2^w =$<br>$[(x+x_{w-1}2^w)\times (y+y_{w-1}2^w)]mod 2^w=[x \times y+(x_{w-1}y+y_{w-1}x)2^w+x_{w-1}y_{w-1}2^{2w}]mod 2^{w}$<br>$=(x \times y)mod2^w$</p>
<p><strong>重点看一下定点数乘法的运算过程</strong></p>
<h4 id="原码乘法"><a href="#原码乘法" class="headerlink" title="原码乘法"></a>原码乘法</h4><p>原码乘法的原理可以用下图表示：</p>
<p><img src="/2018/02/06/20180206/09.jpg" alt="09"></p>
<p><strong>原码乘法的计算过程，如上面的公式表示的那样，$w$位的两个数相乘，最后得到的数是$2w$位。所以用“部分积寄存器”来表示积的高位，用“乘数寄存器”来表示低位。其中，乘数的位为0或者1，0表示不加任何数，1表示加上被乘数。乘数的位值，仅仅是一个标志，表示是否加上被乘数。被乘数保持不变。</strong></p>
<p>具体的实现方法如下：</p>
<p><img src="/2018/02/06/20180206/10.jpg" alt="10"><br>值得注意的是，原码乘法执行的是逻辑右移</p>
<p><img src="/2018/02/06/20180206/11.jpg" alt="11"></p>
<p><img src="/2018/02/06/20180206/12.jpg" alt="12"></p>
<h4 id="补码乘法"><a href="#补码乘法" class="headerlink" title="补码乘法"></a>补码乘法</h4><p>补码乘法有两种：<br>第一是校正法，注意在末尾加上$[-x]_{complement}$</p>
<p><img src="/2018/02/06/20180206/13.jpg" alt="13"></p>
<p><img src="/2018/02/06/20180206/14.jpg" alt="14"></p>
<p><strong>第二种方法是booth方法，booth方法，最后一步不移位，那怎么判断乘积是否结束了呢？<br>看看在乘数寄存器中，新更新的位数，是不是恰好为$w$位？</strong></p>
<p><img src="/2018/02/06/20180206/15.jpg" alt="15"></p>
<h3 id="位运算与定点数乘法"><a href="#位运算与定点数乘法" class="headerlink" title="位运算与定点数乘法"></a>位运算与定点数乘法</h3><p>从上面的分析可以看出，定点数乘法，$w$位的两个数相乘，我们可以得到$2w$位。<br>如果$x$和$y$都是无符号数，并且运行在数据类型是unsigned的$w$位机器上。乘积的低$w$位能够用表达式$x\times y$计算。我们需要一个具有下列原型的函数：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">unsigned unsigned_high_prod(unsigned x,unsigned y);</span><br><span class="line">//计算无符号变量x*y的高w位</span><br></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int signed_high_prod(int x,int y)</span><br><span class="line">//计算x和y采用补码形式的情况下，x*y的高w位</span><br></pre></td></tr></table></figure>
<p>针对上面的公式，我们不妨把计算结果用$2w$来表示<br>$[(x+x_{w-1}2^w)\times (y+y_{w-1}2^w)]mod 2^w=[x \times y+(x_{w-1}y+y_{w-1}x)2^w+x_{w-1}y_{w-1}2^{2w}]mod 2^{w}$</p>
<p>将计算结果对$2^w$取余，比如64位的量，可以对$2^64$取mod，最后的结果是有64位：<br>位分别为0,1,2…63</p>
<p>我们要获得高$32$位，可以<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">unsigned unsigned_high_prod(unsigned x, unsigned y) &#123;</span><br><span class="line">  int sig_x = x &gt;&gt; 31;</span><br><span class="line">  int sig_y = y &gt;&gt; 31;</span><br><span class="line">  int signed_prod = signed_high_prod(x, y);</span><br></pre></td></tr></table></figure></p>
<p>上述运算实现了：<br>$[x \times y+(x_{w-1}y+y_{w-1}x)2^w]mod 2^{w}$</p>
<p>我们将上述值同时移位$w$，就可以实现<br>$[(x \times y) (&gt;&gt;w)+(x_{w-1}y+y_{w-1}x)]$</p>
<p>其中$x_{w-1}$就是$x$的符号位<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int sig_x = x &gt;&gt; 31</span><br><span class="line">//获取x_(w-1)的值</span><br></pre></td></tr></table></figure></p>
<p>其中$x\times y$表示int类型的值，是有符号数。</p>
<p>实现如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;inttypes.h&gt;</span></span><br><span class="line"></span><br><span class="line">int signed_high_prod(int x,int y)</span><br><span class="line">&#123;</span><br><span class="line">    int64_t mul = (int64_t) x*y;</span><br><span class="line">    <span class="built_in">return</span> mul &gt;&gt; 32;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">unsigned unsigned_high_prod(unsigned x,unsigned y)</span><br><span class="line">&#123;</span><br><span class="line">    int sig_x = x &gt;&gt; 31;</span><br><span class="line">    int sig_y = y &gt;&gt; 31;</span><br><span class="line">    int signed_prod = signed_high_prod(x,y);</span><br><span class="line">    <span class="built_in">return</span> signed_prod + sig_x * y + sig_y * x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">unsigned compared_high_prod(unsigned x,unsigned y)</span><br><span class="line">&#123;</span><br><span class="line">    uint64_t mul = (uint64_t) x*y;</span><br><span class="line">    <span class="built_in">return</span> mul &gt;&gt; 32;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    unsigned x = 0x12345678;</span><br><span class="line">    unsigned y = 0xffffffff;</span><br><span class="line"></span><br><span class="line">    int <span class="built_in">test</span> = unsigned_high_prod(x,y);</span><br><span class="line">    int compared = compared_high_prod(x,y);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Test: %8x\n"</span>,<span class="built_in">test</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"compared: %8x\n"</span>,compared);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="本章中的其他一些问题-库函数"><a href="#本章中的其他一些问题-库函数" class="headerlink" title="本章中的其他一些问题(库函数)"></a>本章中的其他一些问题(库函数)</h2><h3 id="calloc-c"><a href="#calloc-c" class="headerlink" title="calloc.c"></a>calloc.c</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void* calloc(size_t nmemb, size_t size);</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;string.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;assert.h&gt;</span></span><br><span class="line"></span><br><span class="line">void* my_calloc(size_t nmemb,size_t size)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(nmemb==0 || size==0)</span><br><span class="line">        <span class="built_in">return</span> NULL;</span><br><span class="line">    size_t buf_size = nmemb * size;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(nmemb == buf_size/size)</span><br><span class="line">    &#123;</span><br><span class="line">        void* ptr = malloc(buf_size);</span><br><span class="line">        memset(ptr,0,buf_size);</span><br><span class="line">        <span class="built_in">return</span> ptr;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> NULL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    void* p;</span><br><span class="line">    p = my_calloc(0x1234,1);</span><br><span class="line">    //一共有0x1234个元素，每个元素1字节</span><br><span class="line">    bool flag = (p!=NULL);</span><br><span class="line">    <span class="keyword">if</span>(flag)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Case 1 :Not Null \n"</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Case 1 :Null\n"</span>);</span><br><span class="line">    free(p);</span><br><span class="line"></span><br><span class="line">    p = my_calloc(SIZE_MAX,2);</span><br><span class="line">    flag = (p==NULL);</span><br><span class="line">    <span class="keyword">if</span>(flag)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Case 2 :NULL\n"</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Case 2 :Not Null\n"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用移位运算完成倍乘"><a href="#使用移位运算完成倍乘" class="headerlink" title="使用移位运算完成倍乘"></a>使用移位运算完成倍乘</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//注意乘数为负数的时候怎么表示？</span><br><span class="line">int A(int x)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> x - (x &lt;&lt; 3);</span><br><span class="line">    //表示-7x</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;assert.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;iostream&gt;</span></span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">int A(int x)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> x + (x &lt;&lt; 4);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int B(int x)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> x - (x &lt;&lt; 3);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int C(int x)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> (x &lt;&lt; 6) - (x &lt;&lt; 2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int D(int x)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> (x &lt;&lt; 4) - (x &lt;&lt; 7);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int x = 0x1;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Case A: %d\n"</span>,A(x));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Case B: %d\n"</span>,B(x));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Case C: %d\n"</span>,C(x));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Case D: %d\n"</span>,D(x));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="移位运算与舍入问题"><a href="#移位运算与舍入问题" class="headerlink" title="移位运算与舍入问题"></a>移位运算与舍入问题</h3><h4 id="仅有乘法或除法"><a href="#仅有乘法或除法" class="headerlink" title="仅有乘法或除法"></a>仅有乘法或除法</h4><p><img src="/2018/02/06/20180206/16.jpg" alt="16"></p>
<p>移位运算的舍入问题，遵循以下不等式：<br>$[x]+[x+\frac{1}{n}]+[x+\frac{2}{n}]+\cdots+[x+\frac{n-1}{n}]=[nx]$</p>
<p>观察上图：<br>从上表中可以看到，当右移8位的时候，得到-49，这与向零舍入的结果-48并不吻合。<br>右移总是向下舍入，而对于向零舍入的负数来说是向上舍入，因此为了保证结果吻合，需要进行一个偏置。</p>
<p>bias偏移规律如下：</p>
<p><img src="/2018/02/06/20180206/17.jpg" alt="17"><br><img src="/2018/02/06/20180206/18.jpg" alt="18"><br><img src="/2018/02/06/20180206/19.jpg" alt="19"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(A&lt;0)</span><br><span class="line">    A+=(1&lt;&lt;k)-1;</span><br><span class="line">A&gt;&gt;n;</span><br></pre></td></tr></table></figure>
<p>实现方法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;assert.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;limits.h&gt;</span></span><br><span class="line"></span><br><span class="line">int divide_power2(int x, int k)</span><br><span class="line">&#123;</span><br><span class="line">    int is_neg = x &amp; INT_MIN;</span><br><span class="line">    <span class="keyword">if</span>(is_neg)</span><br><span class="line">        x += (1&lt;&lt;k)-1;</span><br><span class="line">    <span class="built_in">return</span> x&gt;&gt;k;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int mul3div4(int x)</span><br><span class="line">&#123;</span><br><span class="line">    int mul3 = x+(x&lt;&lt;1);</span><br><span class="line">    <span class="built_in">return</span> divide_power2(mul3,2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int x;</span><br><span class="line">    scanf(<span class="string">"%x"</span>,&amp;x);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%8x\n"</span>,divide_power2(x,2));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%8x\n"</span>,x/4);</span><br><span class="line"></span><br><span class="line">    int y;</span><br><span class="line">    scanf(<span class="string">"%x"</span>,&amp;y);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"mul3div4: %x\n"</span>,mul3div4(y));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"check: %x\n"</span>,3*y/4);</span><br><span class="line">    <span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="乘除法相结合"><a href="#乘除法相结合" class="headerlink" title="乘除法相结合"></a>乘除法相结合</h4><p><img src="/2018/02/06/20180206/20.jpg" alt="20"><br>可以发现我们需要：1、最后$k$位置为0，得到$low$。2、将前面$w-k$位置为0，得到$high$</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//例如：x*(6/8),8=2^3</span><br><span class="line">int low = x &amp; 0x7;</span><br><span class="line">//仅仅保留最后3位，用掩码(111 &amp; x)</span><br><span class="line"></span><br><span class="line">int high = x &amp; ~0x7</span><br><span class="line">//掩码获得x的高位，将低3位置为0</span><br><span class="line"></span><br><span class="line">//low high分别计算</span><br></pre></td></tr></table></figure>
<p>具体实现：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;limits.h&gt;</span></span><br><span class="line"></span><br><span class="line">int threefourths(int x)</span><br><span class="line">&#123;</span><br><span class="line">    int is_neg = x &amp; INT_MIN;</span><br><span class="line">    int low = x &amp; 0x3;</span><br><span class="line">    int high = x &amp; ~0x3;</span><br><span class="line"></span><br><span class="line">    int highd4 = high &gt;&gt; 2;</span><br><span class="line">    int highd4m3 = highd4 + (highd4 &lt;&lt; 1);</span><br><span class="line"></span><br><span class="line">    int lowm3 = low + (low &lt;&lt; 1);</span><br><span class="line">    int bias = (1&lt;&lt;2) - 1;</span><br><span class="line">    <span class="keyword">if</span>(is_neg)</span><br><span class="line">        lowm3 += bias;</span><br><span class="line">    int lowm3d4 = lowm3 &gt;&gt; 2;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">return</span> lowm3d4 + highd4m3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int x;</span><br><span class="line">    scanf(<span class="string">"%d"</span>,&amp;x);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Test: %d\n"</span>,threefourths(x));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Real: %d\n"</span>,x*3/4);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="位模式的表示方式"><a href="#位模式的表示方式" class="headerlink" title="位模式的表示方式"></a>位模式的表示方式</h3><p>$1^{w-k}0^k$<br>$0^{w-k-j}1^k0^j$</p>
<p>这两种都可以用移位来表示</p>
<p>其中$0^{w-k-j}1^k0^j$<br>可以分成三步走：<br>第一步：获取$1^{w-k}0^k$，通过右移实现<br>第二步：获取$0^{w-k}1^k$，通过取反实现<br>第三部：再右移$j$位</p>
<p>实现方法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;iostream&gt;</span></span><br><span class="line"></span><br><span class="line">int A(int k)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> -1 &lt;&lt; k;</span><br><span class="line">    //表示-1重复k次</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int B(int k,int j)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> (~A(k)) &lt;&lt; j;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int x;</span><br><span class="line">    scanf(<span class="string">"%d"</span>,&amp;x);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%8x\n"</span>,A(x));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"0xFFFFFF00\n"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%8x\n"</span>,B(16,8));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"0x00FFFF00\n"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="移位运算时候常见的错误"><a href="#移位运算时候常见的错误" class="headerlink" title="移位运算时候常见的错误"></a>移位运算时候常见的错误</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">int x = random();</span><br><span class="line">int y = random();</span><br><span class="line"></span><br><span class="line">unsigned ux = (unsigned) x;</span><br><span class="line">unsigned uy = (unsigned) y;</span><br></pre></td></tr></table></figure>
<p><strong>补码的非位级表示：对于任意数值</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-x == ~x+1</span><br></pre></td></tr></table></figure></p>
<p>从数学上解释这一点：</p>
<script type="math/tex; mode=display">-^{t}_{w}x=
\begin{cases}
TMin_{w}& \text{x=TMinw}\\
-x& \text{x>TMinw}
\end{cases}</script><p>$2^w-x=-x$<br>$-x$表示$x$的相反数</p>
<p>$2^w-x-1=-x-1$<br>$2^w-1-x$表示全1的位减去$x$，得到~x</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-x=~x+1</span><br></pre></td></tr></table></figure>
<p>成立</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(x&lt;y) == (-x&gt;-y)</span><br><span class="line">//wrong! x=INT_MIN</span><br><span class="line">//此时-x = ~x + 1</span><br><span class="line">//~x=011...1</span><br><span class="line">//~x+1 = 100...0 仍然为INT_MIN</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((x+y)&lt;&lt;4)+y-x == 17*y+15*x</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~x+~y+1=(~x+1)+(~y+1)-1</span><br><span class="line">=-x+-y-1</span><br><span class="line">=-(x+y)-1</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(ux-uy)==-(unsigned)(y-x)</span><br><span class="line">--&gt; -(ux-uy)==(unsigned)(y-x)</span><br><span class="line">--&gt; (uy-ux)==(unsigned)(y-x) 显然成立</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(x&gt;&gt;2)&lt;&lt;2</span><br><span class="line">--&gt; x&amp; ~(0x3)</span><br><span class="line">--&gt; x + -num(00/01/10/11)</span><br><span class="line">--&gt; (x&gt;&gt;2)&lt;&lt;2 &lt;= x</span><br></pre></td></tr></table></figure>
<h3 id="特殊的二进制无穷串"><a href="#特殊的二进制无穷串" class="headerlink" title="特殊的二进制无穷串"></a>特殊的二进制无穷串</h3><p>一些数字的二进制表示是$0.yyy\cdots$，其中$y$是一个$k$位的序列。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">n = 0.yyy...</span><br><span class="line">n&lt;&lt;k = y.yyy...=Y+n</span><br><span class="line">--&gt; n&lt;&lt;k-n=Y</span><br><span class="line">--&gt; n = Y/(2^k-1)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">应用：</span><br><span class="line">a) 101</span><br><span class="line">   Y=5 k=3 n=5/7</span><br><span class="line">b) 0110</span><br><span class="line">   Y=6 k=4 n=6/15=2/5</span><br><span class="line">c) 010011</span><br><span class="line">   Y=19 k=6 n=19/63</span><br></pre></td></tr></table></figure>
<h3 id="用unsigned测试float型数据的大小"><a href="#用unsigned测试float型数据的大小" class="headerlink" title="用unsigned测试float型数据的大小"></a>用unsigned测试float型数据的大小</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"></span><br><span class="line">unsigned f2u(<span class="built_in">float</span> x)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> *(unsigned*) &amp;x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int float_le(<span class="built_in">float</span> x,<span class="built_in">float</span> y)</span><br><span class="line">&#123;</span><br><span class="line">    unsigned ux = f2u(x);</span><br><span class="line">    unsigned uy = f2u(y);</span><br><span class="line"></span><br><span class="line">    unsigned sx = ux &gt;&gt; 31;</span><br><span class="line">    unsigned sy = uy &gt;&gt; 31;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">return</span> sx==sy ? (sx==0 ? ux&lt;=uy : ux&gt;=uy) : sx&gt;sy;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int x,y;</span><br><span class="line">    scanf(<span class="string">"%d%d"</span>,&amp;x,&amp;y);</span><br><span class="line"></span><br><span class="line">    int flag = float_le(x,y);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,flag);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="浮点数概论"><a href="#浮点数概论" class="headerlink" title="浮点数概论"></a>浮点数概论</h2><p><img src="/2018/02/06/20180206/21.jpg" alt="21"></p>
<p>为什么要引入$bias$？<br>因为就小数部分而言，比如$0.1010$，计算机是按照二进制编码来计算$1010=10$，无法表示$2^{-k}$，所以我们引入$bias$来表示。<br>因为没有负值的符号位啊！<br>$e_{k-1}e_{k-2}\cdots e_{0}$，要表示$(-1)00\cdots 0$，只要$0-2^{k-1}$，表示把符号位置为$-1$。<br>可是为什么bias取$2^{k-1}-1$而不是$2^{k-1}$<br>直观上可以这么理解，$00\cdots 0$表示0，而$11\cdots 1 \ 00\cdots0$表示无穷大。<br>所以要除掉那个无穷大的，即为$2^{k-1}-1$</p>
<p>几个问题：<br><strong>1、32位ieee 754的阶码偏移量为何用127?而不是128</strong><br>为了让表示的范围能够对称起来。</p>
<p>当阶码E为全0且尾数M也为全0时，表示的真值x为零，结合符号位S为0或1，有正零和负零之分。<br>当阶码E为全1且尾数M为全0时，表示的真值x为无穷大，结合符号位S为0或1，也有+∞和-∞之分。<br>这样在32位浮点数表示中，要除去E，用全0和全1(255)表示零和无穷大的特殊情况，指数的偏移值不选128(10000000)，而是127(01111111)。<br>对于规格化浮点数，阶码E范围是1~254。</p>
<p>非规格化数$E=1-bias$<br>规格化数$E=e-bias$，其中$e=e_{k-1}e_{k-2}\cdots e_{0}$</p>
<p><strong>对于规格化的值</strong><br>当$exp$的位模式既不全为0，也不全为1，$E=e-bias$<br>$e=e_{k-1}e_{k-2}\cdots e_{0}$<br>$bias=2^{k-1}-1$<br>很显然$e_{min}=1$，则$E_{min}=1-2^{k-1}+1=2-2^{k-1}\geq 2-1=1$<br>同理$e_{max}=2^k-2$，(扣除全部为1的值),$E_{max}=2^k-2-2^{k-1}+1=2^{k-1}-1$</p>
<p>$127=2^{8-1}-1$，此时$k=8$<br>想一想，如果我们让偏移值为128，而不是127，会是什么样？<br>$E_{min}=1-2^7=-127$，所表示的值为$2^{-127}=5.877471754111438\times 10^{-39}$<br>$E_{max}=2^7-2=126$，所表示的值$2^126=8\times 10^{37.9297}$<br>不对称。</p>
<p>而相反，我们让偏移值为127，可以得到取值范围为：<br>$E_{min}=1-2^{7}+1=-126$，$2^{-126}=1.1754943508222875\times 10^{-38}$<br>$E_{max}=2^7-1=127$，$2^{127}=1.7 \times 10^{38.23080944932561}$</p>
<p>很显然，偏移值为127的时候上下对称。</p>
<p><strong>非规格化数的平滑处理</strong><br>为什么要将$E$定义为$1-bias$,这样的方法归功于平滑性的设计。<br>你肯定想问，1是哪里来的？</p>
<p><img src="/2018/02/06/20180206/22.jpg" alt="22"></p>
<h3 id="浮点数编码表示方法"><a href="#浮点数编码表示方法" class="headerlink" title="浮点数编码表示方法"></a>浮点数编码表示方法</h3><p>注意《深入理解计算机系统》这本书中，尾数的表示方法，和现行的中文教材不太一样。<br>在《深入理解计算机系统》这本书中提到：尾数的范围是$[1,2-\epsilon)$<br>而在我们现行的教材上，尾数的范围是$[0,1-\epsilon)$</p>
<p><img src="/2018/02/06/20180206/23.jpg" alt="23"></p>
<p><strong>浮点数编码能够表示的范围</strong></p>
<p><img src="/2018/02/06/20180206/24.jpg" alt="24"></p>
<p>注意在尾数部分，小数点是跟在数符后面的。</p>
<p><img src="/2018/02/06/20180206/25.jpg" alt="25"></p>
<p><img src="/2018/02/06/20180206/26.jpg" alt="26"></p>
<h3 id="浮点数的规格化"><a href="#浮点数的规格化" class="headerlink" title="浮点数的规格化"></a>浮点数的规格化</h3><p>浮点数的规格化表示，要求小数点后的第一位必须是$1$(基数$r=2$)，其他情况如果$r=4$，则小数点后最高2位不全为0。</p>
<p><img src="/2018/02/06/20180206/27.jpg" alt="27"></p>
<h3 id="举例1"><a href="#举例1" class="headerlink" title="举例1"></a>举例1</h3><p><img src="/2018/02/06/20180206/28.jpg" alt="28"></p>
<p><img src="/2018/02/06/20180206/29.jpg" alt="29"><br>特别注意，在这个例子中，阶码是正数，它的补码保持不变，尾数的补码要取反加一</p>
<p><img src="/2018/02/06/20180206/30.jpg" alt="30"></p>
<p>在《深入理解计算机系统》这本书中，规定尾数M是二进制小数，它的范围是$[1,2-\epsilon)$<br>如果按照这样的规定：<br>$7.0=111.0$<br>$111.0=1.11\times 2^{10}$，特别说明这里$2^{10}$表示小数点往右移动2位，$10$是二进制数。<br>可以知道阶码用2位来表示，$E=2$，$M=1.11$，$f=0.11$，$e=bias+E$</p>
<h3 id="举例2"><a href="#举例2" class="headerlink" title="举例2"></a>举例2</h3><p>与Intel兼容的处理器采用“扩展精度”浮点形式。这种格式具有80位字长，1个符号位，k=15个阶码位，1个单独的整数位和n=63个小数位。<br>注意，阶码位15个，其中一个位用来保存阶符。所以如果阶码部分全部为1，其阶码值为$bias=2^{14}-1$<br><strong>最小的正非规格化数</strong><br>$1,11\cdots 1(14) \; 00\cdots 0(62)1$，括号表示位值重复了多少次。<br>相对应的十进制值为$2^{-bias}\times 2 \times 2^{-63}=2^{1-bias-63}$<br>特别注意，非规格化数的偏置值为$1-bias$而不是$-bias$，多乘了一个2，为什么？这个是为了表示非规格化值平滑转换到规格化值。</p>
<p><strong>最小的正规格化数</strong><br>$1,11\cdots 1(14) \; 100\cdots 0(62)=2^{-bias}\times 2^{-1}=2^{-(bias+1)}$</p>
<p><strong>最大的规格化数</strong><br>$0,11\cdots 1(14) \; 11\cdots 1(63)=2^{bias}\times (1-2^{-63})$</p>
<h3 id="举例3"><a href="#举例3" class="headerlink" title="举例3"></a>举例3</h3><p>在2008版的IEEE浮点数标准中，为了表示数$\frac{7}{8}$，很显然$s=0$，表示正数，$7=111.0$，$\frac{7}{8}$表示小数点左移3位。<br>$\frac{7}{8}=\frac{7}{4} \times 2^{-1}$，其中$V=(-1)^{s}\times M \times 2^{E}$，对比一下可以推出$M=\frac{7}{4}$，$E=-1$<br>$bias=2^{4}-1=15$，$e=E+bias=-1+15=14$，14用二进制表示为$01110$，这是阶码字段。<br>尾数字段计算如下：$1.11 \times 2^{E}$，其中1.11扩充成10位。$1100000000$表示尾数字段。<br>$01110 \ combined \ with \ 1100000000=hex(3b00)$</p>
<p>由此我们可以填表：<br><strong>情况1：机器0</strong><br>$bias=2^{4}-1=15$<br>-0，表示机器0，机器0的$M$值为0，由于规格化表示隐含小数点后的第一位是1，所以$e=XXX.100\cdots 0$，即$e=1$，$E=e-bias=1-15=-14$<br>$V=-0 \ D=-0.0$<br>$hex(0b10000 \ 0000000000)=0x8000$</p>
<p><strong>情况2：最小的大于2的值</strong><br>$(-1)^{s} \times M \times 2^{E}$，要使得最小，很显然$E=1$，并且使得$s=0$并且$M$最小。<br>$e=E+bias=1+15=16$，所以阶码部分可以表示成$10000$，再来看$M$，$M$要尽可能小，怎么样才能让$M$尽可能小，$M$为正数。<br>$M=0000000001$，这样该值的二进制表示为$100000000000001$，十六进制为$0x4001$<br>注意到由于是规格化表示，这个数的尾数数值部分应该是$1.000000001$，如果看成是小数点移动，则$10000000001=2^{10}+1=1025$，可以看作小数点向左移动10位，所以$1.000000001=1025/2^{10}=1025/1024$，<br>所对应的$V=\frac{1025}{1024} \times 2^{E}=\frac{1025}{512}=2.001953125$</p>
<p><strong>情况3:512</strong><br>$512.0=2^{9} \times 1$，$1=2^{0}$，可以看作不移动小数点。<br>$M=1.0000000000$，这里只研究小数部分，所以为$.0000000000$<br>$M=1 \; E=9 \quad e=E+bias=9+15=24=0b11000$<br>组合起来$11000 \; 0000000000=0x6000$</p>
<p><strong>最大的非规格化数</strong><br>此时$M$不包括开头的1，最大的值对应的尾数部分是$0.0111111111=001111111111 \times 2^{-10}=\frac{1023}{1024}$<br>再看阶码部分，非规格化数的阶码恒为$E=1-bias=1-15=-14$，综合看来，$\frac{1023}{1024} \times 2^{-14}=\frac{1023}{2^{24}}$<br>上述结果为$6.097555160522461e-05$<br>十六进制的值为$00000001111111111=0x3ff$</p>
<p><strong>负无穷</strong><br>负无穷就是阶码值全部为1，尾数字段全部为0<br>$1111110000000000=0xfc00$</p>
<p><strong>十六进制为3bb0的数</strong><br>$3bb0=011101110110000$，可以去除阶码部分的5位数$01110=14 \quad e=14 \quad E=e-bias=14-15=-1$<br>再看$M=1110110000=$，其实，实际上表示的数为$1.111011$，规格化数中这里的1省略，$.111011=\frac{111011}{2^{6}}=59/64$<br>综上$\frac{59}{64} \times 2^{E}=\frac{59}{128}$</p>
<h3 id="举例4"><a href="#举例4" class="headerlink" title="举例4"></a>举例4</h3><p><img src="/2018/02/06/20180206/31.jpg" alt="31"><br>对于第一行的例子：$\frac{9}{16}$要凑成一个大于1的数<br>$\frac{9}{16}=\frac{9}{8} \times \frac{1}{2}=(1+\frac{1}{8}) \times 2^{-1}=(1+\frac{2}{16}) \times 2^{-1}$<br>$E=-1 \quad e=E+bias=-1+7=6$<br>可以写成是：$f \quad 0010 \quad \quad e \quad 0110$<br>$1 \ 0110 \ 0010$</p>
<p><strong>对于1</strong><br>阶码为$10110$，<br>$e=22 \quad E=e-bias=22-15=7 \quad f=\frac{0b101}{2^{3}}=\frac{1+4}{8}=\frac{5}{8}$<br>$M=1+\frac{5}{8}=\frac{13}{8} \quad V=(-1)^{s} \times M \times 2^{E}=13 \times 2^{4}$</p>
<p>先确定下在格式B中的$frac=1010$，$f=\frac{0b1010}{2^{4}}=\frac{5}{8} \quad M=\frac{13}{8}$<br>$V=(-1)^{s} \times \frac{13}{8} times 2^{E} \quad E-3=4 \quad e=7+bias=14$<br>$14=0b1110$<br>$0 \ 1110 \ 1010$</p>
<p><strong>对于2</strong><br>$e=00111=7 \quad E-7-bias=7-15=-8$<br>$f=\frac{0b110}{8}=\frac{6}{8} \quad M=1+f=\frac{7}{4}$<br>$V=(-1)^{s} \times 2^{E} \times M=- \frac{7}{2^{10}}$</p>
<p>在格式B下：<br>$frac=1100$<br>$f=\frac{0b1100}{16}=\frac{12}{16}=\frac{3}{4} \quad M=1+f=\frac{7}{4}$<br>$M \times 2^{E}=\frac{7}{2^{10}} \quad E=-8 \quad e=E+bias=-8+7=-1$<br><strong>推出在格式B下为非规格化数</strong><br>由此$e=0b0000 \quad E=1-bias=1-7=-6 \quad 2^{-6} \times M = 7 \times 2^{-10}$<br>$f=M=7 \times \frac{1}{2^{4}}$<br>$frac=f \times 16 = 7 = 0b0111$<br>$1 \ 0000 \ 01111$</p>
<p><strong>对于3</strong><br>$e=0b00000 \quad E=1-bias=1-15=-14$<br>$f=M=\frac{0b101}{8}=\frac{1+4}{8}=\frac{5}{8} \quad V=\frac{5}{8} \times 2^{-14}=\frac{5}{2^{17}}$</p>
<p>对于非规格化数<br>$e=0b0000 \quad E=1-bias=1-7=-6$<br>$M \times 2^{E}=\frac{5}{2^{17}} \quad M=f=5 \times 2^{-11}$<br>$frac=f \times 2^4=\frac{5}{2^{7}}$，舍入到1，结果为<br>$0 \ 0000 \ 0001$</p>
<p>$e=0b0000 \quad E=1-bias=1-7=-6$<br>$f=M=\frac{1}{16}$<br>$V=M \times 2^{-6}=\frac{1}{2^{10}}$</p>
<p><strong>对于4</strong><br>$e=0b11011=27 \quad E=e-bias=27-15=12$<br>$f=\frac{0b000}{2^3}=0 \quad M=1$<br>$V=-M \times 2^{12}=-2^{12}$</p>
<p>$frac=0b0000$肯定是不行的，会出现溢出，仅靠e的部分无法表示$2^{12}$<br>阶码位最大为$4$位，能够取得的最大值为$0b1111$，$e=15 \quad E=e-bias=15-7=8$<br>但注意到在IEEE标准中，$1111 \ 0000$表示$\infty$，所以我们让$e=14$<br>$e=14 \quad e=0b1110 \quad E=e-bias=14-7=7$<br>$V=-2^{12}=-2^{5} \times 2^{7}$<br>$-2^{5}$舍入到$-31$，所以$V=-31 \times 2^{7}$</p>
<p>$0000$要向上舍入，而原来的A&lt;0，所以取绝对值减一，舍入到$0000-1=1111$<br>$frac=1111 \quad f=\frac{1111}{16}=\frac{15}{16} \quad M=1+f=\frac{31}{16}$<br>$V=(-1)^{s} \times \frac{31}{16} \times 2^{E}$<br>$\frac{31}{16} \times 2^{E}=31 \times 2^{7}$<br>$e \leq 14$，所以$e \leq 1110 \quad E \leq (e-bias=7)$<br>$\frac{31}{16}$舍入到$31$<br>$E=7 \quad e=1110$<br>$e=1110 \quad frac=1111$<br>$1 \ 1110 \ 1111 \quad V=- \frac{31}{16} \times 2^{7}=-31 \times 2^{3}$</p>
<p><strong>对于5</strong><br>$frac=0b100 \quad f=\frac{0b100}{8}=\frac{4}{8}=\frac{1}{2} \quad M=\frac{3}{2}$<br>$e=0b11000=24 \quad E=e-bias=24-15=9$<br>$V=(-1)^{s} \times 2^{E} \times M=3 \times 2^{8}$</p>
<p>对于B，$frac=0b1000=8$<br>$f=\frac{8}{16}=\frac{1}{2} \quad M=1+f=\frac{3}{2}$<br>$V=3 \times 2^{8}$<br>$3 \times 2^{8}=\frac{3}{2} \times 2^{E} \quad 2^{8}=2^{E-1} \quad E=9$<br>$e=9+7=16$，很显然溢出了。<br>向正无穷舍入$\frac{3}{2}$舍入到$\frac{6}{2}$，即有$3 \times 2^{8}=\frac{3}{2} \times 2^{E}$<br>$E=8 \quad e=8+7=15 \quad e=0b1111$<br>$e=0b1111$，很显然结果为$\infty$<br>$0 \ 1111 \ 0000 \quad V=\infty$</p>
<h3 id="举例5"><a href="#举例5" class="headerlink" title="举例5"></a>举例5</h3><p>float类型的值使用32位的IEEE格式，double类型的值使用64位IEEE格式。<br>随机数转换成为double类型的值，来测试精度的转换。</p>
<p>这里值得注意的是，浮点运算一般是不能结合的。<br>主要是因为舍入的问题，容易出错。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0.2+0.3=0.5-&gt;1</span><br><span class="line">1+0.5=1.5-&gt;2</span><br><span class="line"></span><br><span class="line">0.3+0.5=0.8-&gt;1</span><br><span class="line">0.2+1=1.2-&gt;1</span><br><span class="line"></span><br><span class="line">(0.2+0.3)+0.5=1+0.5-&gt;2</span><br><span class="line">0.2+(0.3+0.5)=0.2+1-&gt;1</span><br><span class="line">二者并不相等</span><br></pre></td></tr></table></figure></p>
<p>在本机上，运行相关代码得到的结果如下：<br><img src="/2018/02/06/20180206/32.jpg" alt="32"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;iostream&gt;</span></span><br><span class="line"><span class="comment">#include &lt;limits.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;assert.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;ctime&gt;</span></span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">/*int create_random()</span><br><span class="line">&#123;</span><br><span class="line">    srand((unsigned)time(NULL));</span><br><span class="line">    <span class="built_in">return</span> rand();</span><br><span class="line">&#125;*/</span><br><span class="line"></span><br><span class="line">int A(int x,double dx)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> (<span class="built_in">float</span>) x == (<span class="built_in">float</span>) dx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int B(int x,int y,double dx,double dy)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> (dx-dy) == (double) (x-y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int C(double dx,double dy,double dz)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> (dx+dy)+dz == dx+(dy+dz);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int D(double dx,double dy,double dz)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> (dx*dy)*dz == dx*(dy*dz);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int E(double dx,double dz)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> dx/dx == dz/dz;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    srand( (unsigned)time(NULL) );</span><br><span class="line">    int x = rand();</span><br><span class="line">    int y = rand();</span><br><span class="line">    int z = rand();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"x: %d\n"</span>,x);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"y: %d\n"</span>,y);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"z: %d\n"</span>,z);</span><br><span class="line"></span><br><span class="line">    double dx = (double) x;</span><br><span class="line">    double dy = (double) y;</span><br><span class="line">    double dz = (double) z;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"check:\n"</span>);</span><br><span class="line">    cout&lt;&lt;<span class="string">"A: "</span>&lt;&lt;A(x,dx)&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;<span class="string">"Another A: "</span>&lt;&lt;A(0x20001,(double)0x20001)&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;<span class="string">"B: "</span>&lt;&lt;B(0,INT_MIN,(double)0,(double)INT_MIN)&lt;&lt;endl;</span><br><span class="line">    dx = (double)0x2001;</span><br><span class="line">    dy = (double)INT_MIN;</span><br><span class="line">    dz = (double)100;</span><br><span class="line">    cout&lt;&lt;<span class="string">"C: "</span>&lt;&lt;C(dx,dy,dz)&lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">    cout&lt;&lt;<span class="string">"rand c:"</span>&lt;&lt;endl;</span><br><span class="line">    dx = (double)rand();</span><br><span class="line">    dy = (double)rand();</span><br><span class="line">    dz = (double)rand();</span><br><span class="line">    cout&lt;&lt;C(dx,dy,dz)&lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">    dx = (double)rand();</span><br><span class="line">    dy = (double)0xFFFFFFFF;</span><br><span class="line">    dz = (double)INT_MIN;</span><br><span class="line">    cout&lt;&lt;<span class="string">"D: "</span>&lt;&lt;D(dx,dy,dz)&lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">    dx = (double)rand();</span><br><span class="line">    cout&lt;&lt;<span class="string">"E: "</span>&lt;&lt;E(dx,(double)0)&lt;&lt;endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从以上代码可以看出：<br>减法行为，在<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x=0;</span><br><span class="line">y=INT_MIN;</span><br></pre></td></tr></table></figure></p>
<p>会出现溢出错误。</p>
<p>除法行为，在除数为0的时候会发生错误。</p>
<h3 id="举例6"><a href="#举例6" class="headerlink" title="举例6"></a>举例6</h3><p>编写一个C函数来计算$2^{x}$的浮点表示。完成这个任务最好的方法是直接创建结果的IEEE单精度表示。当$x$太小时，你的程序会返回$0.0$，当x太大时，它会返回$+ \infty$。填写代码的空白部分，计算正确结果。假设函数$u2f$返回的浮点值与它的无符号参数有相同的位表示。</p>
<p><strong>浮点值和无符号参数的位表示相同</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">float</span> u2f(unsigned x)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> *(<span class="built_in">float</span>*) &amp;x;</span><br><span class="line">    // &amp;x是变量x的地址</span><br><span class="line">    // (<span class="built_in">float</span>*) &amp;x 获取<span class="built_in">float</span>型指针</span><br><span class="line">    // *(<span class="built_in">float</span>*) &amp;x 对指针解引用，得到<span class="built_in">float</span>型的值</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>$2^{x}$的浮点表示，最终结果是IEEE的单精度表示，如下图所示：<br><img src="/2018/02/06/20180206/33.jpg" alt="33"></p>
<p>先确定偏置量，$bias$等于$exp$中的位数。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bias=1&lt;&lt;(8-1)-1=pow(2,7)-1=127</span><br><span class="line"></span><br><span class="line">//Denormalized</span><br><span class="line">E=1-bias=2-pow(2,7)</span><br><span class="line"></span><br><span class="line">//Normalized</span><br><span class="line">E=e-bias=e-pow(2,7)</span><br></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">float</span> fpwr2(int x)</span><br><span class="line">&#123;</span><br><span class="line">    // x仅仅表示指数，只需要观察指数部分</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>浮点表示：$(-1)^{s} \times frac \times 2^{E}$</p>
<p><strong>1、x小于最小的非规格化数</strong><br>此时$E=1-bias=2-pow(2,7)$，而frac部分有23位，全部清0，相当于$2^E&gt;&gt;23$，右移23位可以让$frac$部分清0，这样得到的数比最小的非规格化数还小<br>$2^{E}&gt;&gt;23$，此时满足的条件是：$x&lt;2-pow(2,7)-23$</p>
<p><strong>2、x小于最小的规格化数，此时$2^x$表示非规格化数</strong><br>此时$e=1$，$bias=pow(2,7)-1$，$E=e-bias=2-pow(2,7)$<br>$x&lt;2-pow(2,7)$，此时仅有frac部分。</p>
<p>很显然，此时$E=0$，$2^{E}=1$，所以$2^{x}=frac$<br>$frac=2^{x}=2^{b}$，$b$此时的值是$x$相对于最小基准$2-pow(2,7)-23$，即只取超出$2-pow(2,7)-23$的部分。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frac=1&lt;&lt;(unsigned)(x-(2-pow(2,7)-23))</span><br></pre></td></tr></table></figure></p>
<p><strong>3、x小于最大的规格化数，此时$2^x$表示规格化数</strong><br>最大的规格化数，此时指数$E=bias=pow(2,7)-1$，注意到此时E可以取到$pow(2,7)-1$</p>
<p>此时取$frac=0$<br>$2^{x}=2^{E}$，$x=E=exp-bias$，可以得到$exp=x+bias=x+pow(2,7)-1$</p>
<p><strong>4、剩余情况，取无穷</strong><br>$exp=0xFF$<br>$frac=0$</p>
<p>实现代码如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;assert.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;math.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;iostream&gt;</span></span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line"><span class="built_in">float</span> u2f(unsigned x)</span><br><span class="line">//这里涉及到无符号数转换成浮点数</span><br><span class="line">//使用引用</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> *(<span class="built_in">float</span>*) &amp;x;</span><br><span class="line">    // &amp;x是变量x的地址</span><br><span class="line">    // (<span class="built_in">float</span>*) &amp;x 获取<span class="built_in">float</span>型指针</span><br><span class="line">    // *(<span class="built_in">float</span>*) &amp;x 对指针解引用，得到<span class="built_in">float</span>型的值</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">float</span> fpwr2(int x)</span><br><span class="line">&#123;</span><br><span class="line">    unsigned expr,frac;</span><br><span class="line">    unsigned u;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(x &lt; 2-pow(2,7)-23)</span><br><span class="line">    &#123;</span><br><span class="line">        expr = 0;</span><br><span class="line">        frac = 0;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(x &lt; 2-pow(2,7))</span><br><span class="line">    &#123;</span><br><span class="line">        expr = 0;</span><br><span class="line">        frac = 1 &lt;&lt; (unsigned)(x - (2-pow(2,7)-23) );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(x &lt; pow(2,7)-1+1)</span><br><span class="line">    &#123;</span><br><span class="line">        expr = x + pow(2,7) - 1;</span><br><span class="line">        frac = 0;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        expr = 0xFF;</span><br><span class="line">        frac = 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    u = expr &lt;&lt; 23 | frac;</span><br><span class="line">    <span class="built_in">return</span> u2f(u);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    cout&lt;&lt;<span class="string">"calculate: "</span>&lt;&lt;powf(2,0)&lt;&lt;<span class="string">" test: "</span>&lt;&lt;fpwr2(0)&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;<span class="string">"calculate: "</span>&lt;&lt;powf(2,100)&lt;&lt;<span class="string">" test: "</span>&lt;&lt;fpwr2(100)&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;<span class="string">"calculate: "</span>&lt;&lt;powf(2,-100)&lt;&lt;<span class="string">" test: "</span>&lt;&lt;fpwr2(-100)&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;<span class="string">"calculate: "</span>&lt;&lt;powf(2,10000)&lt;&lt;<span class="string">" test: "</span>&lt;&lt;fpwr2(10000)&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;<span class="string">"calculate: "</span>&lt;&lt;powf(2,-10000)&lt;&lt;<span class="string">" test: "</span>&lt;&lt;fpwr2(-10000)&lt;&lt;endl;</span><br><span class="line">    <span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="举例7"><a href="#举例7" class="headerlink" title="举例7"></a>举例7</h3><p>$\pi$的单精度浮点值的十六进制表示为$0x40490FDB$<br>注意，给的数为单精度浮点型的小数，frac部分有23位，exp部分有8位。<br><strong>1、二进制小数</strong><br>表示的二进制小数的小数部分为：<br>$100 \ 1001 \ 0000 \ 1111 \ 1101 \ 1011$<br>二进制小数的阶码部分为：<br>$1000 \ 0000$<br>$bias=2^{8-1}-1=127$<br>$E=exp-bias=128-127=1$<br>由于二进制的阶码部分不为0，所以二进制小数是规格化数，二进制小数可以如下表示：<br>$1.100 \ 1001 \ 0000 \ 1111 \ 1101 \ 1011$<br>二进制小数可以表示成：<br>$1.100 1001 0000 1111 1101 1011 \times 2^{1}=11.0010010000111111011011$</p>
<p><strong>2、$\frac{22}{7}$的二进制小数表示是什么</strong><br>$\frac{22}{7}=3+\frac{1}{7}$<br>$3=0b11$<br>$\frac{1}{7}$的二进制小数表示是：<br>$\frac{Y}{2^{k}-1}$，可以知道$Y=1 \ k=3$，$y$是一个3位的序列。<br>可以看作$1&gt;&gt;3=\frac{1}{2^{3}-1}=0.001$<br>综上$\frac{22}{7}$的二进制表示是：$0b11.001001001(001)$</p>
<p><strong>3、这两个$\pi$的近似值从小数点后第九位开始不同</strong></p>
<h2 id="位级浮点编码规则"><a href="#位级浮点编码规则" class="headerlink" title="位级浮点编码规则"></a>位级浮点编码规则</h2><p>对于参数$f$，如果$f$是非规格化的，该函数返回$\pm0$<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">float_bits float_denorm_zero(float_bits f)</span><br><span class="line">&#123;</span><br><span class="line">    unsigned sign = f &gt;&gt; 31;</span><br><span class="line">    //相当于把小数点放置在第31位后面，这样就得到符号位</span><br><span class="line"></span><br><span class="line">    unsigned exp = f &gt;&gt; 23 &amp; 0xFF;</span><br><span class="line">    //相当于把小数点放置在exp位置之后，这样就得到了阶码部分</span><br><span class="line">    //取出相应的值，只要&amp;ff就可以</span><br><span class="line"></span><br><span class="line">    unsigned frac = f &amp; 0x7FFFFF;</span><br><span class="line">    //只取小数位，共23位</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(exp == 0)</span><br><span class="line">    &#123;</span><br><span class="line">        frac = 0;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">return</span> (sign &lt;&lt; 31) | (exp &lt;&lt; 23) | frac;</span><br><span class="line">    //这里移动小数点，相当于右移小数点</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="例1"><a href="#例1" class="headerlink" title="例1"></a>例1</h3><p>对于浮点数$f$，计算$-f$，如果$f=\infty$，函数返回$f$<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;iostream&gt;</span></span><br><span class="line"><span class="comment">#include "float_negate.h"</span></span><br><span class="line"><span class="comment">#include &lt;math.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;cmath&gt;</span></span><br><span class="line"><span class="comment">#include &lt;algorithm&gt;</span></span><br><span class="line"><span class="comment">#include &lt;assert.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;string.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;cstring&gt;</span></span><br><span class="line"><span class="comment">#include &lt;limits.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;climits&gt;</span></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">float_bits float_negate(float_bits f)</span><br><span class="line">&#123;</span><br><span class="line">    unsigned sign = f &gt;&gt; 31;</span><br><span class="line">    cout &lt;&lt; sign &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    unsigned exp = f &gt;&gt; 23 &amp; 0xFF;</span><br><span class="line">    cout &lt;&lt; exp &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    unsigned frac = f &amp; 0x7FFFFF;</span><br><span class="line">    cout &lt;&lt; frac &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(exp == 0xFF &amp;&amp; frac != 0)  //NAN</span><br><span class="line">        <span class="built_in">return</span> f;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">return</span> (~sign &lt;&lt; 31) | (exp &lt;&lt; 23) | (frac);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    unsigned testV;</span><br><span class="line">    cin &gt;&gt; testV;</span><br><span class="line">    </span><br><span class="line">    unsigned res = float_negate(testV);</span><br><span class="line">    cout &lt;&lt; <span class="string">"test value is "</span> &lt;&lt; *(<span class="built_in">float</span>*) (&amp;res) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">"The real value is "</span> &lt;&lt; -(*(<span class="built_in">float</span>*)(&amp;testV)) &lt;&lt; endl;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>实现结果：<br><img src="/2018/02/06/20180206/34.jpg" alt="34"></p>
<h3 id="例2"><a href="#例2" class="headerlink" title="例2"></a>例2</h3><p>遵循位级浮点编码规则，实现具有如下原型的函数：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">float_bits float_absval(float_bits f);</span><br></pre></td></tr></table></figure></p>
<p>实现方法如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;iostream&gt;</span></span><br><span class="line"><span class="comment">#include &lt;limits.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;math.h&gt;</span></span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> * <span class="built_in">float</span>-absval.h</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">typedef unsigned float_bits;</span><br><span class="line"></span><br><span class="line">float_bits float_absval(float_bits f);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">float_bits float_absval(float_bits f)</span><br><span class="line">&#123;</span><br><span class="line">    unsigned sign = f &gt;&gt; 31;</span><br><span class="line">    unsigned exp = f &gt;&gt; 23 &amp; 0xFF;</span><br><span class="line">    unsigned frac = f &amp; 0x7FFFFF;</span><br><span class="line"></span><br><span class="line">    int is_NAN = (exp == 0xFF) &amp;&amp; (frac != 0);</span><br><span class="line">    <span class="keyword">if</span>(is_NAN)</span><br><span class="line">        <span class="built_in">return</span> f;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">return</span> 0 &lt;&lt; 31 | exp &lt;&lt; 23 | frac;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">float</span> u2f(unsigned u)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> *(<span class="built_in">float</span>*) &amp;u;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">unsigned f2u(<span class="built_in">float</span> u)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> *(unsigned*) &amp;u;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    unsigned testV;</span><br><span class="line">    <span class="built_in">float</span> f_test;</span><br><span class="line">    cin &gt;&gt; testV &gt;&gt; f_test;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">float</span> testF = u2f(testV);</span><br><span class="line"></span><br><span class="line">    unsigned u_test = f2u(f_test);</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(isnan(testF))</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">"test "</span> &lt;&lt; testF;</span><br><span class="line">        cout &lt;&lt; <span class="string">"real "</span> &lt;&lt; testV;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">"test1= "</span> &lt;&lt; u2f(float_absval(testV)) &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">"real1= "</span> &lt;&lt; fabs(testF) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">        cout &lt;&lt; <span class="string">"test2= "</span> &lt;&lt; u2f(float_absval(u_test)) &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">"real2= "</span> &lt;&lt; fabs(f_test) &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>结果：<br><img src="/2018/02/06/20180206/35.jpg" alt="35"></p>
<h3 id="例3"><a href="#例3" class="headerlink" title="例3"></a>例3</h3><p>实现能够计算$2.0 \times f$的函数。</p>
<p>实现函数如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;iostream&gt;</span></span><br><span class="line"><span class="comment">#include &lt;limits.h&gt;</span></span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">typedef unsigned float_bits;</span><br><span class="line"></span><br><span class="line">float_bits float_half(float_bits f);</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">    本例中要求舍入到偶数</span><br><span class="line">    0b00 --&gt; 0b00 + addition(0) = 0b00</span><br><span class="line">    0b01 --&gt; 0b00 + addition(0) = 0b00</span><br><span class="line">    0b10 --&gt; 0b01 + addition(0) = 0b01</span><br><span class="line">    0b11 --&gt; /2=1.5=2 --&gt; 0b01 + addition(1) = 0b10</span><br><span class="line"></span><br><span class="line">    only 0b11 --&gt; addition = 1</span><br><span class="line">    <span class="keyword">if</span> &amp;0b11 == 0b11</span><br><span class="line">        addition = 1</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        addition = 0</span><br><span class="line"></span><br><span class="line">    addition = (frac &amp; 0x3) == 0x3</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">float_bits float_half(float_bits f)</span><br><span class="line">&#123;</span><br><span class="line">    unsigned sign = f &gt;&gt; 31;</span><br><span class="line">    unsigned exp = f &gt;&gt; 23 &amp; 0xFF;</span><br><span class="line">    unsigned frac = f &amp; 0x7FFFFF;</span><br><span class="line"></span><br><span class="line">    unsigned remain = f &amp; 0x7FFFFFFF;</span><br><span class="line"></span><br><span class="line">    int is_NAN_or_infinity = (exp == 0xFF);</span><br><span class="line">    <span class="keyword">if</span>(is_NAN_or_infinity)&#123;</span><br><span class="line">        <span class="built_in">return</span> f;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    int addition = (frac &amp; 0x3) == 0x3;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(exp == 0)</span><br><span class="line">    &#123;</span><br><span class="line">        //Denormalized</span><br><span class="line">        frac &gt;&gt;= 1;</span><br><span class="line">        frac += addition;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(exp == 1)</span><br><span class="line">    &#123;</span><br><span class="line">        //Normalized to Denormalized</span><br><span class="line">        remain &gt;&gt;= 1;</span><br><span class="line">        remain += addition;</span><br><span class="line">        exp = (remain &gt;&gt; 23) &amp; 0xFF;</span><br><span class="line">        frac = remain &amp; 0x7FFFFF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        //include factor 2</span><br><span class="line">        exp -= 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">return</span> sign &lt;&lt; 31 | exp &lt;&lt; 23 | frac;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">float</span> u2f(unsigned u)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> *(<span class="built_in">float</span>*) &amp;u;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">unsigned f2u(<span class="built_in">float</span> u)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> *(unsigned*) &amp;u;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">float</span> f_test;</span><br><span class="line">    cout &lt;&lt; <span class="string">"input float : "</span>;</span><br><span class="line">    cin &gt;&gt; f_test;</span><br><span class="line"></span><br><span class="line">    unsigned u_test = f2u(f_test);</span><br><span class="line">    <span class="built_in">float</span> real = f_test / 2;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">"real: "</span> &lt;&lt; real &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">"test: "</span> &lt;&lt; u2f(float_half(u_test)) &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>结果：<br><img src="/2018/02/06/20180206/36.jpg" alt="36"></p>
<h3 id="例4"><a href="#例4" class="headerlink" title="例4"></a>例4</h3><p>对于浮点数f，这个函数计算(int)f，如果f是NaN，你的函数应该向0舍入。如果f不能用整数表示，例如，超出表示范围，或者它是一个NaN，那么函数应该返回0x800000000</p>
<p>我们这里仅仅考虑正数的情况：<br>有如下几种：</p>
<p>第一种：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0 00000000 00000000000000000000000</span><br><span class="line">    ===&gt;</span><br><span class="line">0 01111111 00000000000000000000000</span><br></pre></td></tr></table></figure></p>
<p>值所能表示的范围是：<br>$1.0 \times 2^{0}$，此时$2^{E}=2^0$，对应的指数的值为$E=exp-bias=0$，可以求出$exp=7$</p>
<p>取值范围为：$0 \leq f \leq 1$，值舍入到0</p>
<p>第二种：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0 01111111 00000000000000000000000</span><br><span class="line">    ===&gt;</span><br><span class="line">0 (01111111+31) 00000000000000000000000</span><br></pre></td></tr></table></figure></p>
<p>此时，我们得到的上界为$NaN$，浮点数可以表示32为整数，其中最高位为符号位，能够表示的最大的值为$2^{31}-1$，所以最大的$int$用浮点数表示就是：<br>0 (01111111+31) 00000000000000000000000</p>
<p>第三种：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0 (01111111+31) 00000000000000000000000</span><br><span class="line">    ===&gt;</span><br><span class="line">infinity</span><br><span class="line"><span class="built_in">return</span> 0x80000000</span><br></pre></td></tr></table></figure></p>
<p>值得注意的是，把浮点数转换成整形，必须<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frac | 0x80000000</span><br></pre></td></tr></table></figure></p>
<p>来获取整数部分，如何最后我们如何舍去小数部分？<br>采用移位的方式：<br>$\pm \ 1.frac \times 2^{exp-bias}$，用移位的方式去掉frac部分，如下图：<br><img src="/2018/02/06/20180206/37.jpg" alt="37"></p>
<p>最后我们得到$M \times 2^{E}$，相当于我们在$M$的基础上，执行M&lt;&lt;E运算。</p>
<p><strong>如果$E&gt;23$</strong>，则执行$ M \times 2^E $，相当于小数点右移23位，除去小数点，然后再整体执行左移(E-23)位，即M&lt;&lt;(E-23)</p>
<p><strong>如果$E&lt;23$</strong>，则执行$M \times 2^{E}$之后还会有小数点，小数点并不能完全消除掉。我们要人为地把小数点后的数全部抛弃，此时小数点的位置在距离末尾(23-E)处，此时M&gt;&gt;(23-E)，即可舍去小数点后的部分。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> * <span class="built_in">float</span>-f2i.h</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;iostream&gt;</span></span><br><span class="line"><span class="comment">#include &lt;limits.h&gt;</span></span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">typedef unsigned float_bits;</span><br><span class="line"></span><br><span class="line">int float_f2i(float_bits f);</span><br><span class="line"></span><br><span class="line">int float_f2i(float_bits f)</span><br><span class="line">&#123;</span><br><span class="line">    unsigned sign = f &gt;&gt; 31;</span><br><span class="line">    unsigned exp = f &gt;&gt; 23 &amp; 0xFF;</span><br><span class="line">    unsigned frac = f &amp; 0x7FFFFF;</span><br><span class="line">    unsigned bias = 0x7F;</span><br><span class="line"></span><br><span class="line">    /*</span><br><span class="line">        consider positive numbers</span><br><span class="line"></span><br><span class="line">        0 00000000 00000000000000000000000</span><br><span class="line">        ===&gt;</span><br><span class="line">        0 01111111 00000000000000000000000</span><br><span class="line">        1.0*(2^0),now E=exp-bias=0,means exp=7</span><br><span class="line">        exp=1111111</span><br><span class="line">        now 0&lt;=f&lt;=1</span><br><span class="line">        we get <span class="built_in">integer</span> 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        0 01111111 00000000000000000000000</span><br><span class="line">        now E=exp-bias=0 2^E=1</span><br><span class="line">        ===&gt;</span><br><span class="line">        NaN的取值为多少？我们注意到浮点数可以表示32位整数，最高位是符号位</span><br><span class="line">        所以能表示的最大的值是2^&#123;31&#125;-1</span><br><span class="line">        上面这个数用浮点数表示是：</span><br><span class="line">        0 (01111111+31) 00000000000000000000</span><br><span class="line">    */</span><br><span class="line">    unsigned M;</span><br><span class="line">    unsigned E;</span><br><span class="line">    int val;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(exp &gt;=0 &amp;&amp; exp &lt; 0 + bias)</span><br><span class="line">    &#123;</span><br><span class="line">        val = 0;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(exp &gt;= 31 + bias)</span><br><span class="line">    &#123;</span><br><span class="line">        //overflow</span><br><span class="line">        val = 0x80000000;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        E = exp - bias;</span><br><span class="line">        M = frac | 0x800000;</span><br><span class="line">        <span class="keyword">if</span>(E &gt; 23)</span><br><span class="line">            val = M &lt;&lt; (E - 23);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            val = M &gt;&gt; (23 - E);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">return</span> sign ? -val : val;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int u2i(unsigned u)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> *(int*) &amp;u;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">unsigned i2u(int u)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> *(unsigned*) &amp;u;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">unsigned f2u(<span class="built_in">float</span> u)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> *(unsigned*) &amp;u;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">float</span> f_test;</span><br><span class="line">    cout &lt;&lt; <span class="string">"input float : "</span>;</span><br><span class="line">    cin &gt;&gt; f_test;</span><br><span class="line"></span><br><span class="line">    unsigned u_test = f2u(f_test);</span><br><span class="line">    int real = (int)f_test;</span><br><span class="line">    //注意，<span class="built_in">float</span>转换为int，要舍入，直接(int) float_v</span><br><span class="line">    //而不是*(int*) float_v</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">"real : "</span> &lt;&lt; real &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">"test : "</span> &lt;&lt; float_f2i(u_test) &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意，float转换为int，要舍入，直接(int) float_v<br>而不是<em>(int</em>) float_v</p>
<h3 id="例5"><a href="#例5" class="headerlink" title="例5"></a>例5</h3><p>给出一个函数计算(float) i的位级表示。<br><strong>浮点数向偶数舍入的问题</strong><br>有效数字超出规定数位，例如，多余数字是1001，超出了规定最低位的一半，(规定最低位的一半为：1000)，故最低位进1.<br>如果多余数字是0111，它小于最低位的一半，则舍掉多余数字（截断尾数）即可<br>如果对于数字是1000，正好是最低位一半的特殊情况，例如：0 1000，最低位为0，舍掉多余位，1 1000，最低位为1，则舍掉多余位后加1，使得最低位为0(偶数)。</p>
<p>举例，要求保留小数点后3位。</p>
<p>对于1.0011001，舍入处理后为1.010（去掉多余的4位，加0.001）<br>对于1.0010111，舍入处理后为1.001（去掉多余的4位）<br>对于1.0011000，舍入处理后为1.010（去掉多余的4位，加0.001，使得最低位为0） </p>
<p>对于1.1001001，舍入处理后为1.101（去掉多余的4位，加0.001）<br>对于1.1000111，舍入处理后为1.100（去掉多余的4位）<br>对于1.1001000，舍入处理后为1.100（去掉多余的4位，不加，因为最低位已经为0） </p>
<p>对于1.01011，舍入处理后为1.011（去掉多余的2位，加0.001）<br>对于1.01001，舍入处理后为1.010（去掉多余的2位）<br>对于1.01010，舍入处理后为1.010（去掉多余的2位，不加） </p>
<p>对于1.01111，舍入处理后为1.100（去掉多余的2位，加0.001）<br>对于1.01101，舍入处理后为1.011（去掉多余的2位）<br>对于1.01110，舍入处理后为1.100（去掉多余的2位，加0.001）</p>
<p>在整数向浮点数转换的过程中，很重要的一点是，浮点数写成$2^{E}$，一定是规格化数，所以$exp$不为0。因为$exp$等于0的情况我们单独考虑。</p>
<p><strong>整数转换成浮点数，需要以下几个函数：</strong><br><strong>$bit-length()$判断int型有几位，是否超过了最大的32位</strong><br><strong>frac的位数可能会超过23位，这个时候我们要把特定的舍入位数，比如低xx位取出来，完成这个取出任务所需要的函数是$bits-mask()$，给位数盖一个面罩，然后取出</strong><br>值得注意的是，由于int转换成float，必定为规格化数，所以最后的fbits=bits-1，float型的frac部分要减去最开始的1</p>
<p>比较难以理解的是$i=0xffffffff$的情况，此时整数转换成浮点数，是一个$-2^{E}$，注意此时frac为0，因为整数并不包含小数点后的部分，frac部分为1.0000…，是一个绝对值非常非常大的负数，指数expe要尽可能大，如果把指数看成是小数点移位的话，指数最大可以取多少呢？可以移动多少位呢？最多为31位。<br>expe=bias+31</p>
<p>我们让expe=bias+fbits，这样可以看成是小数点在最左边，然后往右移动fbits位。唯一要考虑的就是23位够不够放int型的整数？<br>int型的整数，罩上mask，获取val值，来进行移位操作<br>val=i &amp; bits_mask(fbits)</p>
<p><strong>如果值为负数，记得取反加1</strong></p>
<h4 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h4><p>1、首先考虑符号位，然后讲i取绝对值，当成一个正数转化即可。然后判断i是2的几次幂，可以通过类似于二分法的方式判断。即右移16位判断是否不为0，如果不为0则exp+16，然后判断右移16位后剩余的位数有几位，否则右移8位判断依次类推。<br>2、因为是正数，小数点左边存在一个隐式的1，所以num=( ~ (1&lt;&lt; exp ) ) &amp; num ;把最高的1去掉，然后把剩余的数放进frac中，同时要考虑向偶数取整的问题。<br>3、如果num不足23位，直接移动相应位数，放入frac中，否则截掉多余的位数，如果最后一位并且舍去一段中的最高也为1或者舍去的东西超过0.5那么就给frac+1，判断一下frac时候有溢出，溢出的话给exp+1，然后取剩余的23位的值即可。最后就是给exp加上bias偏置值，前提是如果num不为0。</p>
<p>重要思路：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">unsigned val = i;</span><br><span class="line">unsigned sign = i &lt; 0 ? 1 : 0;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(sign)</span><br><span class="line">    val = ~val + 1;</span><br><span class="line"></span><br><span class="line">unsigned exp = 0;</span><br><span class="line">unsigned frac = 0;</span><br><span class="line">unsigned temp = val;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(val &gt;&gt; 16)</span><br><span class="line">&#123;</span><br><span class="line">    exp += 0x10; //除以16，再加回来</span><br><span class="line">    val = val &gt;&gt; 0x10;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(val &gt;&gt; 8)</span><br><span class="line">&#123;</span><br><span class="line">    exp += 0x8;</span><br><span class="line">    val = val &gt;&gt; 0x8;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(val &gt;&gt; 4)</span><br><span class="line">&#123;</span><br><span class="line">    exp += 0x4;</span><br><span class="line">    val = val &gt;&gt; 0x4;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(val &gt;&gt; 2)</span><br><span class="line">&#123;</span><br><span class="line">    exp += 0x2;</span><br><span class="line">    val = val &gt;&gt; 0x2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(val &gt;&gt; 1)</span><br><span class="line">&#123;</span><br><span class="line">    exp += 0x1;</span><br><span class="line">    val = val &gt;&gt; 0x1;</span><br><span class="line">&#125;</span><br><span class="line">//此时exp表示小数点从右边开始，往左多少位</span><br><span class="line"></span><br><span class="line">//去掉小数点最高位1</span><br><span class="line">val = temp;</span><br><span class="line">val = (~(1 &lt;&lt; exp)) &amp; val;</span><br><span class="line">//此时val为小数点后面的部分</span><br><span class="line"></span><br><span class="line">// (temp &gt;&gt; 23)判断temp大于23位</span><br></pre></td></tr></table></figure></p>
<p><strong>最终$\times 2^{expe}$小数点在最右边，所以expe实际上表示小数点的实际位置：即从最右边开始，向左移动expe位就是小数点实际位置</strong></p>
<p><strong>舍入原则上面说明了，值得注意的是，向偶数舍入，frac+=1，可能会造成frac溢出</strong><br>例如： frac=111 1111 1111 1111 1111 1111<br>frac+1=1000 0000 0000 0000 0000 0000<br>相当于小数点从右边开始移动到实际位置要多移动1位，所以是expe+=1<br>frac=frac &amp; 0x7fffff<br>取最后23位</p>
<p>可能遇到的情况描述如下图：<br><img src="/2018/02/06/20180206/38.jpg" alt="38"><br><img src="/2018/02/06/20180206/39.jpg" alt="39"><br><img src="/2018/02/06/20180206/40.jpg" alt="40"></p>
<p>实现方法：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;limits.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;iostream&gt;</span></span><br><span class="line"><span class="comment">#include &lt;cstdio&gt;</span></span><br><span class="line"><span class="comment">#include &lt;math.h&gt;</span></span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">typedef unsigned float_bits;</span><br><span class="line"></span><br><span class="line">float_bits float_i2f(int i);</span><br><span class="line"></span><br><span class="line">unsigned mask(unsigned bits)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> (1 &lt;&lt; bits) - 1;</span><br><span class="line">&#125;</span><br><span class="line">unsigned leftmost(unsigned bits)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> 1 &lt;&lt; bits;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">float_bits float_i2f(int i)</span><br><span class="line">&#123;</span><br><span class="line">    unsigned val = i;</span><br><span class="line">    unsigned sign = i &lt; 0 ? 1 : 0;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(sign)</span><br><span class="line">        val = ~val + 1;</span><br><span class="line">    </span><br><span class="line">    unsigned expe = 0;</span><br><span class="line">    unsigned frac = 0;</span><br><span class="line">    unsigned temp = val;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(val &gt;&gt; 16)</span><br><span class="line">    &#123;</span><br><span class="line">        expe += 0x10; //除以16，再加回来</span><br><span class="line">        val = val &gt;&gt; 0x10;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(val &gt;&gt; 8)</span><br><span class="line">    &#123;</span><br><span class="line">        expe += 0x8;</span><br><span class="line">        val = val &gt;&gt; 0x8;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(val &gt;&gt; 4)</span><br><span class="line">    &#123;</span><br><span class="line">        expe += 0x4;</span><br><span class="line">        val = val &gt;&gt; 0x4;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(val &gt;&gt; 2)</span><br><span class="line">    &#123;</span><br><span class="line">        expe += 0x2;</span><br><span class="line">        val = val &gt;&gt; 0x2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(val &gt;&gt; 1)</span><br><span class="line">    &#123;</span><br><span class="line">        expe += 0x1;</span><br><span class="line">        val = val &gt;&gt; 0x1;</span><br><span class="line">    &#125;</span><br><span class="line">    //此时expe表示小数点从右边开始，往左多少位</span><br><span class="line"></span><br><span class="line">    //去掉小数点最高位1</span><br><span class="line">    val = temp;</span><br><span class="line">    val = (~(1 &lt;&lt; expe)) &amp; val;</span><br><span class="line">    //此时val为小数点后面的部分</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(temp &gt;&gt; 23)</span><br><span class="line">    &#123;</span><br><span class="line">        unsigned offset = expe - 23;</span><br><span class="line">        //溢出部分</span><br><span class="line">        frac = val &gt;&gt; offset;</span><br><span class="line">        unsigned roundv = 0;</span><br><span class="line">        unsigned round_bits = val &amp; mask(offset);</span><br><span class="line">        int cond1 = ( (val &amp; mask(offset)) &gt; leftmost(offset-1));</span><br><span class="line">        int cond2 = ( (frac &amp; 0x1) &amp;&amp; (round_bits == leftmost(offset-1)) );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>( (expe != 23) &amp;&amp; (cond1 || cond2) )</span><br><span class="line">        &#123;</span><br><span class="line">            frac += 1;</span><br><span class="line">        &#125;</span><br><span class="line">        //向偶数舍入溢出了怎么办？</span><br><span class="line">        //小数点从右边开始，往左边多移动1位</span><br><span class="line">        <span class="keyword">if</span>(frac &gt;&gt; 23)</span><br><span class="line">        &#123;</span><br><span class="line">            expe += 1;</span><br><span class="line">            frac = frac &amp; 0x7fffff;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        frac = val &lt;&lt; (23 - expe);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(temp)</span><br><span class="line">        expe += 127;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">return</span> sign &lt;&lt; 31 | expe &lt;&lt; 23 | frac;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">float</span> u2f(unsigned u)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">return</span> *(<span class="built_in">float</span>*)&amp;u;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int i_test;</span><br><span class="line">    cout &lt;&lt; <span class="string">"input int: "</span>;</span><br><span class="line">    scanf(<span class="string">"%d"</span>,&amp;i_test);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">float</span> real = (<span class="built_in">float</span>) i_test;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"real: %f\n"</span>,real);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"test: %f\n"</span>,u2f(float_i2f(i_test)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/2018/02/06/20180206/41.jpg" alt="41"></p>

      
    </div>
    <footer class="article-footer">
      
        <div id="donation_div"></div>

<script src="/js/vdonate.js"></script>
<script>
var a = new Donate({
  title: '如果觉得我的文章对您有用，请随意打赏。您的支持将鼓励我继续创作!', // 可选参数，打赏标题
  btnText: '打赏支持', // 可选参数，打赏按钮文字
  el: document.getElementById('donation_div'),
  wechatImage: '/css/images/wechatpay.jpg',
  alipayImage: '/css/images/alipay.jpg'
});
</script>
      
      
      <div>
        <ul class="post-copyright">
          <li class="post-copyright-author">
          <strong>本文作者:  </strong>Fogsail Chen
          </li>
          <li class="post-copyright-link">
          <strong>本文链接:  </strong>
          <a href="/2018/02/06/20180206/" target="_blank" title="《csapp》实践：信息的表示和处理">https://www.fogsail.net/2018/02/06/20180206/</a>
          </li>
          <li class="post-copyright-license">
            <strong>版权声明:   </strong>
            本博客所有文章除特别声明外，均采用 <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">CC BY-NC-ND 4.0</a>
            许可协议。转载请注明出处
          </li>
         
        </ul>
<div>
</div></div>
      
      
        
	<section id="comments" class="comment">
		<!-- hello world! -->
		
		<!--<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>-->
		<script src="https://cdnjs.loli.net/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<script src="//unpkg.com/valine/dist/Valine.min.js"></script>
		<div id="vcomments"></div>
		<script>
			new Valine({
				el: '#vcomments',
				appId: '6jvLbmDexHR56M68z5z4o66q-gzGzoHsz',
				appKey: 'WXDOtEMHclOT8f1EeGS0xDor',
				verify: true
			})
		</script>
	</section>


      
      
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/计算机系统结构/">计算机系统结构</a></li></ul>

      

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/02/22/20180222/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          hexo博客部署到腾讯云服务器上
        
      </div>
    </a>
  
  
    <a href="/2018/02/04/20180204/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">儿时游戏：数组和字符串模拟</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="toc-sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#show-bytes"><span class="nav-number">1.</span> <span class="nav-text">show bytes</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#位级整数编码原则"><span class="nav-number">2.</span> <span class="nav-text">位级整数编码原则</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#算术右移和逻辑右移的关系"><span class="nav-number">2.1.</span> <span class="nav-text">算术右移和逻辑右移的关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#算术右移和逻辑右移相互表示"><span class="nav-number">2.2.</span> <span class="nav-text">算术右移和逻辑右移相互表示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#判断奇数位是否为1"><span class="nav-number">2.3.</span> <span class="nav-text">判断奇数位是否为1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二分法位运算：有多少个位包含1"><span class="nav-number">2.4.</span> <span class="nav-text">二分法位运算：有多少个位包含1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二分法运算：只保留最高位的1"><span class="nav-number">2.5.</span> <span class="nav-text">二分法运算：只保留最高位的1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#移位运算需要注意的"><span class="nav-number">2.6.</span> <span class="nav-text">移位运算需要注意的</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#位级运算完成置位"><span class="nav-number">2.7.</span> <span class="nav-text">位级运算完成置位</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#lower-one-mask"><span class="nav-number">2.7.1.</span> <span class="nav-text">lower_one_mask</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#旋转：rotate-left"><span class="nav-number">2.7.2.</span> <span class="nav-text">旋转：rotate_left</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#补码运算的原理"><span class="nav-number">2.8.</span> <span class="nav-text">补码运算的原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#xbyte"><span class="nav-number">2.9.</span> <span class="nav-text">xbyte</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#位运算实现饱和加法"><span class="nav-number">2.10.</span> <span class="nav-text">位运算实现饱和加法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#理解定点数的乘法"><span class="nav-number">2.11.</span> <span class="nav-text">理解定点数的乘法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#原码乘法"><span class="nav-number">2.11.1.</span> <span class="nav-text">原码乘法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#补码乘法"><span class="nav-number">2.11.2.</span> <span class="nav-text">补码乘法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#位运算与定点数乘法"><span class="nav-number">2.12.</span> <span class="nav-text">位运算与定点数乘法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#本章中的其他一些问题-库函数"><span class="nav-number">3.</span> <span class="nav-text">本章中的其他一些问题(库函数)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#calloc-c"><span class="nav-number">3.1.</span> <span class="nav-text">calloc.c</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用移位运算完成倍乘"><span class="nav-number">3.2.</span> <span class="nav-text">使用移位运算完成倍乘</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#移位运算与舍入问题"><span class="nav-number">3.3.</span> <span class="nav-text">移位运算与舍入问题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#仅有乘法或除法"><span class="nav-number">3.3.1.</span> <span class="nav-text">仅有乘法或除法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#乘除法相结合"><span class="nav-number">3.3.2.</span> <span class="nav-text">乘除法相结合</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#位模式的表示方式"><span class="nav-number">3.4.</span> <span class="nav-text">位模式的表示方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#移位运算时候常见的错误"><span class="nav-number">3.5.</span> <span class="nav-text">移位运算时候常见的错误</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#特殊的二进制无穷串"><span class="nav-number">3.6.</span> <span class="nav-text">特殊的二进制无穷串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#用unsigned测试float型数据的大小"><span class="nav-number">3.7.</span> <span class="nav-text">用unsigned测试float型数据的大小</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#浮点数概论"><span class="nav-number">4.</span> <span class="nav-text">浮点数概论</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#浮点数编码表示方法"><span class="nav-number">4.1.</span> <span class="nav-text">浮点数编码表示方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#浮点数的规格化"><span class="nav-number">4.2.</span> <span class="nav-text">浮点数的规格化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#举例1"><span class="nav-number">4.3.</span> <span class="nav-text">举例1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#举例2"><span class="nav-number">4.4.</span> <span class="nav-text">举例2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#举例3"><span class="nav-number">4.5.</span> <span class="nav-text">举例3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#举例4"><span class="nav-number">4.6.</span> <span class="nav-text">举例4</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#举例5"><span class="nav-number">4.7.</span> <span class="nav-text">举例5</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#举例6"><span class="nav-number">4.8.</span> <span class="nav-text">举例6</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#举例7"><span class="nav-number">4.9.</span> <span class="nav-text">举例7</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#位级浮点编码规则"><span class="nav-number">5.</span> <span class="nav-text">位级浮点编码规则</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#例1"><span class="nav-number">5.1.</span> <span class="nav-text">例1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#例2"><span class="nav-number">5.2.</span> <span class="nav-text">例2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#例3"><span class="nav-number">5.3.</span> <span class="nav-text">例3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#例4"><span class="nav-number">5.4.</span> <span class="nav-text">例4</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#例5"><span class="nav-number">5.5.</span> <span class="nav-text">例5</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#思路"><span class="nav-number">5.5.1.</span> <span class="nav-text">思路</span></a></li></ol></li></ol></li></ol>
    
    </div>
  </aside>

</section>
        
      </div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <!-- <p> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/iTimeTraveler/hexo-theme-hiker" target="_blank">Hexo-theme-hiker</a> </p> -->
	      <p id="copyRightEn">Copyright &copy; 2013 - 2020 算法小站 All Rights Reserved.</p>
        <p><a target="_blank" href="http://www.miitbeian.gov.cn">闽ICP备18003953号-1</a></p>
        <p>
          <img src="\css\images\gongan.png" style="float: center">
          <a target="_blank" href="http://www.miitbeian.gov.cn">闽公网安备 35010202000760号</a></p>
        <!--
	      
    		<p class="busuanzi_uv">
				访客数 : <span id="busuanzi_value_site_uv"></span> |  
				访问量 : <span id="busuanzi_value_site_pv"></span>
		    </p>
  		   
         -->
		</div>

		
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/categories" class="mobile-nav-link">Categories</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/scripts.js"></script>

<script>
  (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();
  </script>




  <script src="/js/dialog.js"></script>



<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-114571328-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->






	<div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>



	<script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?eefa70020af0829b6b4b9a6151d8a943";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



<!-- Tencent Analytics -->
	<script type="text/javascript">
    (function() {
      var hm = document.createElement("script");
      hm.src = "//tajs.qq.com/stats?sId=65332004";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>
<!-- End Tencent Analytics -->


  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">设置</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              正文字号大小
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            您已调整页面字体大小
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              夜间护眼模式
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            夜间模式已经开启，再次单击按钮即可关闭 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关 于&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            算法小站
          </div>
          <div class="panel-body">
            Copyright © 2020 Fogsail Chen All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
    <a id="menu-switch"><i class="fa fa-bars fa-lg"></i></a>
  
</body>
</html>